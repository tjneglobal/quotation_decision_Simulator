<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¥ä»·å†³ç­–å®éªŒå®¤ V5.1 (CN) - Fixed</title>
    <style>
        /* --- Base Styles (V5.0 CN) --- */
        :root {
            --primary-color: #0f172a;
            --accent-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-color: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #334155;
            --text-light: #64748b;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'PingFang SC', 'Microsoft YaHei', 'Segoe UI', Roboto, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); line-height: 1.6; min-height: 100vh; display: flex; flex-direction: column; }

        /* --- Layout --- */
        header { background-color: var(--primary-color); color: white; padding: 1rem 2rem; display: none; justify-content: space-between; align-items: center; box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; }
        .brand h1 { font-size: 1.25rem; font-weight: 600; }
        .brand span { color: var(--accent-color); font-size: 0.8rem; display: block; font-weight: 400; }
        
        .game-status { display: flex; gap: 1.5rem; align-items: center; }
        .mode-display { font-size: 0.8rem; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 4px; }
        .level-badge { background: var(--accent-color); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .level-badge.l1 { background: #10b981; }
        .level-badge.l2 { background: #f59e0b; color: #000; }
        .level-badge.l3 { background: #ef4444; }

        .status-item strong { color: var(--accent-color); font-size: 1.1rem; }
        
        main { flex: 1; padding: 2rem; max-width: 1200px; margin: 0 auto; width: 100%; display: none; grid-template-columns: 1fr 1fr; gap: 2rem; }
        @media (max-width: 900px) { main { grid-template-columns: 1fr; } }

        /* --- Cards --- */
        .card { background: var(--card-bg); border-radius: var(--border-radius); padding: 2rem; box-shadow: var(--shadow); display: flex; flex-direction: column; gap: 1.5rem; }
        .card-header { border-bottom: 1px solid #e2e8f0; padding-bottom: 1rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 1.1rem; font-weight: 600; color: var(--primary-color); display: flex; align-items: center; gap: 0.5rem; }

        /* --- Inquiry Visuals --- */
        .inquiry-paper { background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 4px; padding: 1.5rem; font-family: 'Courier New', Courier, monospace; font-size: 0.9rem; position: relative; }
        .inquiry-paper::before { content: "è¯¢ä»·å•"; position: absolute; top: -10px; right: 20px; background: var(--text-light); color: white; padding: 2px 8px; font-size: 0.7rem; font-weight: bold; border-radius: 2px; }
        .data-row { display: flex; margin-bottom: 0.8rem; border-bottom: 1px dashed #e2e8f0; padding-bottom: 0.4rem; }
        .data-label { width: 140px; font-weight: bold; color: var(--text-light); flex-shrink: 0; }
        .data-value { flex: 1; color: var(--primary-color); }
        .highlight-bad { color: var(--danger-color); font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* --- Interaction --- */
        .strategy-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        .strategy-btn { background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.2s; text-align: center; position: relative; height: 100%; display: flex; flex-direction: column; justify-content: center;}
        .strategy-btn:hover { border-color: var(--accent-color); transform: translateY(-2px); }
        .strategy-btn.selected { background-color: #eff6ff; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
        .strategy-btn h4 { margin-bottom: 0.5rem; font-size: 0.95rem; color: var(--primary-color); }
        .strategy-btn p { font-size: 0.75rem; color: var(--text-light); line-height: 1.3; }

        .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; }
        .checkbox-label { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; cursor: pointer; padding: 0.5rem; border-radius: 6px; transition: background 0.2s; }
        .checkbox-label:hover { background: #f8fafc; }
        .checkbox-label input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--accent-color); }

        textarea { width: 100%; padding: 1rem; border: 1px solid #cbd5e1; border-radius: 8px; resize: vertical; min-height: 120px; font-size: 0.95rem; transition: border 0.2s; }
        textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }

        .action-area { margin-top: auto; }
        .btn-primary { width: 100%; padding: 1rem; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .btn-primary:hover { background: #2563eb; }
        .btn-primary:disabled { background: #94a3b8; cursor: not-allowed; }

        .policy-note { font-size: 0.8rem; color: var(--text-light); margin-top: 0.8rem; padding-top: 0.8rem; border-top: 1px dashed #e2e8f0; font-style: italic; }

        /* --- Modal & Feedback --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; z-index: 1000; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { background: white; width: 90%; max-width: 600px; border-radius: var(--border-radius); padding: 2rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); transform: scale(0.9); transition: transform 0.3s; max-height: 90vh; overflow-y: auto; }
        .modal-overlay.active .modal-content { transform: scale(1); }

        .score-circle { width: 100px; height: 100px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 0 auto 1.5rem auto; border: 4px solid #e2e8f0; flex-shrink: 0; }
        .score-number { font-size: 2.5rem; font-weight: 700; line-height: 1; }
        .score-total { font-size: 0.8rem; opacity: 0.8; }

        .feedback-section { margin-bottom: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid var(--text-light); }
        .feedback-section.success { border-left-color: var(--success-color); }
        .feedback-section.warning { border-left-color: var(--warning-color); }
        .feedback-section.error { border-left-color: var(--danger-color); }
        .feedback-section.outcome { background: #eff6ff; border-left: 4px solid var(--accent-color); font-weight: 500; }
        .feedback-section.block { background: #fef2f2; border: 2px solid var(--danger-color); color: #7f1d1d; }
        .feedback-section.authority { background: #1e293b; color: white; text-align: center; border: 2px solid #334155; margin-bottom: 1.5rem; }

        .feedback-title { font-weight: 700; margin-bottom: 0.5rem; display: block; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.05em; }

        .score-breakdown { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; }
        .breakdown-item { display: flex; justify-content: space-between; font-size: 0.9rem; }

        .next-btn { background: var(--primary-color); color: white; padding: 0.8rem 2rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; display: block; margin: 0 auto; }
        .btn-restart { background: white; border: 1px solid var(--text-light); color: var(--text-main); margin-top: 10px;}

        /* --- Intro & Mode Selection (V5.1 Fixed) --- */
        #intro-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 500; display: flex; justify-content: center; align-items: center; padding: 2rem; overflow-y: auto;}
        
        /* Container for the toggle cards */
        .intro-wrapper { width: 100%; max-width: 900px; display: flex; flex-direction: column; gap: 2rem; align-items: center; }
        
        .intro-card { background: white; padding: 2rem; border-radius: var(--border-radius); box-shadow: var(--shadow); width: 100%; display: flex; flex-direction: column; gap: 1.5rem; }
        
        .level-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; text-align: center; }
        .level-box { padding: 1rem; border-radius: 8px; font-size: 0.9rem; text-align: left; border: 1px solid #e2e8f0; }
        .level-box h4 { margin-bottom: 0.5rem; font-size: 1rem; }
        .lvl-1 { background: #d1fae5; color: #065f46; }
        .lvl-2 { background: #fef3c7; color: #92400e; }
        .lvl-3 { background: #fee2e2; color: #991b1b; }

        .mode-selector { display: flex; justify-content: center; gap: 1rem; }
        .mode-btn { flex: 1; padding: 1.5rem; border: 1px solid #e2e8f0; background: white; border-radius: 8px; cursor: pointer; text-align: center; transition: all 0.2s; }
        .mode-btn:hover { border-color: var(--accent-color); background: #eff6ff; }
        .mode-btn.primary { background: var(--primary-color); color: white; border: none; }
        .mode-btn.primary:hover { background: #2563eb; }
        .mode-label { font-weight: 700; font-size: 1.1rem; color: var(--primary-color); display: block; margin-bottom: 0.2rem; }
        .mode-desc { font-size: 0.85rem; color: var(--text-light); }
        .mode-desc-secondary { font-size: 0.75rem; color: #94a3b8; display: block; margin-top: 0.2rem; }

        /* --- Manual / Instruction Page Styles (Fixed Layout) --- */
        /* Manual acts as an absolute overlay to ensure it sits on top of everything else when active */
        .manual-container { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: white; 
            z-index: 600; /* Higher than intro screen content */
            padding: 2rem; 
            display: none; 
            opacity: 0; 
            transition: opacity 0.3s ease;
            overflow-y: auto; /* Allow scrolling if content exceeds viewport */
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
        
        .manual-container.active { 
            display: block; 
            opacity: 1; 
        }
        
        /* Restrict width of the manual content itself for readability */
        .manual-content-wrapper {
            max-width: 900px; 
            margin: 0 auto; 
        }

        .manual-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; background: white; z-index: 10; }
        .manual-back { background: transparent; border: 1px solid #cbd5e1; color: var(--text-main); padding: 0.5rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s; font-size: 0.9rem; }
        .manual-back:hover { background: #f1f5f9; border-color: var(--accent-color); }

        .instruction-section { margin-bottom: 2.5rem; padding-bottom: 2.5rem; border-bottom: 1px dashed #e2e8f0; }
        .instruction-section:last-child { border-bottom: none; }
        
        .instruction-section h2 { font-size: 1.4rem; color: var(--primary-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .instruction-section h3 { font-size: 1.1rem; color: var(--primary-color); margin-bottom: 0.8rem; margin-top: 1.5rem; border-left: 4px solid var(--accent-color); padding-left: 0.8rem; }

        .instruction-section ul { margin: 0.5rem 0 0 1.5rem; font-size: 0.95rem; color: var(--text-main); list-style-type: circle; }
        .instruction-section ul li { margin-bottom: 0.6rem; line-height: 1.6; }

        .instruction-section p { margin-bottom: 0.8rem; color: var(--text-main); font-size: 0.95rem; line-height: 1.6; }

        table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9rem; background: white; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
        table th, table td { border: 1px solid #e2e8f0; padding: 0.8rem; text-align: left; }
        table th { background: #f8fafc; font-weight: 600; }
        table tr:nth-child(even) { background: #f8fafc; }

        .note { background: #fff7ed; border-left: 4px solid var(--warning-color); padding: 1rem 1.2rem; margin-top: 1rem; font-size: 0.9rem; color: #9a3412; border-radius: 4px; }

        /* --- Session Summary Screen Styles --- */
        #summary-screen { display: none; padding: 2rem; max-width: 1000px; margin: 2rem auto; }
        .summary-container { background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 3rem; }
        .summary-header { text-align: center; border-bottom: 2px solid #e2e8f0; padding-bottom: 2rem; margin-bottom: 2rem; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem; }
        .summary-module { background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0; }
        .module-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-light); margin-bottom: 1rem; font-weight: 700; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 1rem; }
        .stat-value { font-weight: 600; }
        .stat-value.red { color: var(--danger-color); }
        .stat-value.green { color: var(--success-color); }
        .authority-block { background: var(--primary-color); color: white; padding: 2rem; border-radius: 12px; text-align: center; margin-top: 2rem; }
        .authority-status { font-size: 2rem; font-weight: 800; margin: 1rem 0; }
        .authority-sub { font-size: 1rem; opacity: 0.9; }
        .authority-scope { margin-top: 1rem; font-size: 0.9rem; background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; display: inline-block; border-radius: 4px; }
        .cap-item { display: flex; justify-content: space-between; padding: 0.8rem 0; border-bottom: 1px dashed #e2e8f0; }
        footer { text-align: center; padding: 1rem; color: var(--text-light); font-size: 0.8rem; }
    </style>
</head>
<body>

    <!-- Intro Screen (Fixed Structure) -->
    <div id="intro-screen">
        
        <!-- Instruction / Manual Container (Overlay) -->
        <div class="manual-container" id="manual-view">
            <div class="manual-content-wrapper">
                <!-- Manual Header -->
                <div class="manual-nav">
                    <button class="manual-back" onclick="game.backToMenu()">
                        â¬… è¿”å›è¯„ä¼°å…¥å£
                    </button>
                    <h2 style="margin: 0;">ç³»ç»Ÿè¯´æ˜ä¹¦</h2>
                </div>

                <div class="instruction-section">
                    <h2>ä¸€ã€ç³»ç»Ÿè®¾ç«‹èƒŒæ™¯ä¸ç›®çš„</h2>
                    <h3>1.1 è®¾ç«‹èƒŒæ™¯</h3>
                    <p>åœ¨é¡¹ç›®å‹ã€å®šåˆ¶åŒ–åŠè·¨å¢ƒä¸šåŠ¡ä¸­ï¼ŒæŠ¥ä»·è¡Œä¸ºç›´æ¥å½±å“å…¬å¸ä»¥ä¸‹æ ¸å¿ƒé£é™©ï¼š</p>
                    <ul>
                        <li>å›æ¬¾é£é™©</li>
                        <li>åˆ©æ¶¦ä¾µèš€é£é™©</li>
                        <li>äº¤ä»˜ä¸è¿çº¦é£é™©</li>
                        <li>æŠ¥ä»·æˆæƒå¤±æ§é£é™©</li>
                    </ul>
                    <p>ä¼ ç»Ÿä¾èµ–ä¸ªäººç»éªŒçš„æŠ¥ä»·æ–¹å¼ï¼Œå­˜åœ¨é€»è¾‘ä¸å¯è¿½æº¯ã€é£é™©è¯†åˆ«ä¸ä¸€è‡´ã€æƒé™è¾¹ç•Œæ¨¡ç³Šç­‰é—®é¢˜ã€‚</p>

                    <h3>1.2 ç³»ç»Ÿç›®çš„</h3>
                    <ul>
                        <li>æ ‡å‡†åŒ–æŠ¥ä»·å†³ç­–é€»è¾‘</li>
                        <li>é‡åŒ–æŠ¥ä»·èƒ½åŠ›ä¸é£é™©æ„è¯†</li>
                        <li>åŒºåˆ†è®­ç»ƒè¡Œä¸ºä¸æˆæƒè¯„ä¼°è¡Œä¸º</li>
                        <li>ä¸ºæŠ¥ä»·æƒé™æˆäºˆæä¾›åˆ¶åº¦ä¾æ®</li>
                    </ul>
                </div>

                <div class="instruction-section">
                    <h2>äºŒã€ç³»ç»Ÿæ•´ä½“æ¶æ„è¯´æ˜</h2>
                    <p>ç³»ç»Ÿç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
                    <ul>
                        <li>è®­ç»ƒæ¨¡å—ï¼ˆTraining Modeï¼‰</li>
                        <li>è¯„ä¼°æ¨¡å—ï¼ˆAssessment Modeï¼‰</li>
                        <li>ä¼šè¯æ€»ç»“ä¸æˆæƒåˆ¤å®šæ¨¡å—ï¼ˆSession Summaryï¼‰</li>
                    </ul>
                    <p>ç³»ç»ŸåŸºäºçœŸå®ä¸šåŠ¡æŠ½è±¡çš„æ ‡å‡†åœºæ™¯åº“è¿è¡Œï¼Œè¦†ç›–å…¬å¸ä¸»è¦äº§å“çº¿ä¸å®¢æˆ·ç±»å‹ã€‚</p>
                </div>

                <div class="instruction-section">
                    <h2>ä¸‰ã€æ¨¡å¼åˆ’åˆ†è¯´æ˜ï¼ˆæ ¸å¿ƒåˆ¶åº¦ç‚¹ï¼‰</h2>

                    <div class="level-grid">
                        <div class="level-box lvl-1">
                            <h4 style="color:#065f46">3.1 è®­ç»ƒæ¨¡å¼ï¼ˆTraining Modeï¼‰</h4>
                            <ul style="padding-left:1rem; list-style-type:disc; color: #334155;">
                                <li>æ˜¾ç¤ºé£é™©æç¤ºä¸è¿‡ç¨‹åé¦ˆ</li>
                                <li>æ˜¾ç¤ºå®Œæ•´è¯„åˆ†æ‹†è§£</li>
                                <li>ä»…ç”¨äºèƒ½åŠ›è®­ç»ƒ</li>
                            </ul>
                        </div>
                        <div class="level-box lvl-2">
                            <h4 style="color:#92400e">3.2 è¯„ä¼°æ¨¡å¼ï¼ˆAssessment Modeï¼‰</h4>
                            <ul style="padding-left:1rem; list-style-type:disc; color: #334155;">
                                <li>ä¸æ˜¾ç¤ºè¿‡ç¨‹æ€§é£é™©æç¤º</li>
                                <li>å¼ºåˆ¶åŒ…å«é«˜é£é™©åœºæ™¯</li>
                                <li>è¾“å‡ºæ˜ç¡®æˆæƒç»“è®º</li>
                            </ul>
                        </div>
                    </div>
                    <div class="note">è®­ç»ƒæ¨¡å¼ç»“æœä¸ä½œä¸ºæŠ¥ä»·æˆæƒä¾æ®ã€‚</div>
                </div>

                <div class="instruction-section">
                    <h2>å››ã€åœºæ™¯ä¸åˆ†çº§è®¾è®¡</h2>

                    <table>
                        <tr>
                            <th>ç­‰çº§</th>
                            <th>å®šä½</th>
                            <th>æ ¸å¿ƒè€ƒå¯Ÿç‚¹</th>
                        </tr>
                        <tr>
                            <td><strong>Level 1</strong></td>
                            <td><strong>åŸºç¡€çº§</strong></td>
                            <td>é¿å…æ˜æ˜¾æŠ¥ä»·é”™è¯¯<br>å»ºç«‹åŸºæœ¬é£é™©æ„è¯†</td>
                        </tr>
                        <tr>
                            <td><strong>Level 2</strong></td>
                            <td><strong>ç†Ÿç»ƒçº§</strong></td>
                            <td>åœ¨ä»·æ ¼ã€é£é™©ä¸æˆäº¤æ¦‚ç‡<br>ä¹‹é—´è¿›è¡Œæƒè¡¡</td>
                        </tr>
                        <tr>
                            <td><strong>Level 3</strong></td>
                            <td><strong>éª¨å¹²çº§</strong></td>
                            <td>å…·å¤‡ç³»ç»Ÿæ€§é£é™©æ§åˆ¶<br>ä¸å¤æ‚åœºæ™¯åˆ¤æ–­èƒ½åŠ›</td>
                        </tr>
                    </table>
                </div>

                <div class="instruction-section">
                    <h2>äº”ã€è¯„ä¼°ä¼šè¯æœºåˆ¶ï¼ˆé˜²è¿æ°”è®¾è®¡ï¼‰</h2>
                    <ul>
                        <li>æ¯æ¬¡ä¼šè¯å›ºå®šæŠ½å– 3 ä¸ªæŠ¥ä»·åœºæ™¯</li>
                        <li>è‡³å°‘åŒ…å« 1 ä¸ª Level 3 ä¸” Critical é£é™©åœºæ™¯</li>
                        <li>è‡³å°‘åŒ…å« 1 ä¸ª Payment/Delivery ä¸æ¸…åœºæ™¯</li>
                    </ul>
                </div>

                <div class="instruction-section">
                    <h2>å…­ã€è¯„åˆ†ç»“æ„ä¸ç®¡ç†å±‚å¦å†³æœºåˆ¶</h2>

                    <table>
                        <tr>
                            <th>è¯„åˆ†æ¨¡å—</th>
                            <th>æƒé‡</th>
                            <th>è¯´æ˜</th>
                        </tr>
                        <tr>
                            <td>æŠ¥ä»·ç­–ç•¥åˆ¤æ–­</td>
                            <td>30%</td>
                            <td>æ˜¯å¦åŒ¹é…é£é™©ç­‰çº§</td>
                        </tr>
                        <tr>
                            <td>é£é™©æ§åˆ¶æ„è¯†</td>
                            <td>25%</td>
                            <td>æ˜¯å¦è¡¥å……å…³é”®æ¡æ¬¾</td>
                        </tr>
                        <tr>
                            <td>æ¡æ¬¾åˆç†æ€§</td>
                            <td>15%</td>
                            <td>æ˜¯å¦å­˜åœ¨è¿‡åº¦æ§åˆ¶</td>
                        </tr>
                        <tr>
                            <td>å†³ç­–è¯´æ˜é€»è¾‘</td>
                            <td>30%</td>
                            <td>æ˜¯å¦å…·å¤‡å› æœé€»è¾‘</td>
                        </tr>
                    </table>

                    <div class="note">
                        åœ¨é«˜é£é™©æˆ– Critical åœºæ™¯ä¸­é‡‡ç”¨æ¿€è¿›æŠ¥ä»·ï¼Œæˆ–æœªè¡¥å……å…³é”®é£é™©æ¡æ¬¾ï¼Œå°†è§¦å‘ç®¡ç†å±‚å¦å†³ã€‚
                    </div>
                </div>

                <div class="instruction-section">
                    <h2>ä¸ƒã€è¯„ä¼°ç»“æœä¸æŠ¥ä»·æƒé™æ˜ å°„</h2>

                    <table>
                        <tr>
                            <th>è¯„ä¼°ç»“æœ</th>
                            <th>å«ä¹‰</th>
                        </tr>
                        <tr>
                            <td style="color:var(--success-color); font-weight:bold;">APPROVED</td>
                            <td>å…·å¤‡ç‹¬ç«‹æŠ¥ä»·èƒ½åŠ›</td>
                        </tr>
                        <tr>
                            <td style="color:var(--warning-color); font-weight:bold;">REVIEW REQUIRED</td>
                            <td>éœ€ä¸»ç®¡å¤æ ¸</td>
                        </tr>
                        <tr>
                            <td style="color:var(--danger-color); font-weight:bold;">NOT APPROVED</td>
                            <td>ä¸å…·å¤‡ç‹¬ç«‹æŠ¥ä»·èµ„æ ¼</td>
                        </tr>
                    </table>

                    <div class="note">
                        éœ€è¿ç»­ 2 æ¬¡ Assessment é€šè¿‡ï¼Œæ–¹å¯æˆäºˆé•¿æœŸæŠ¥ä»·æƒé™ã€‚
                    </div>
                </div>

                <div class="instruction-section">
                    <h2>å…«ã€åˆ¶åº¦å±æ€§å£°æ˜</h2>
                    <ul>
                        <li>æœ¬ç³»ç»Ÿä¸ºå†…éƒ¨ç®¡ç†ä¸åŸ¹è®­å·¥å…·</li>
                        <li>ä¸æ›¿ä»£å…¬å¸æœ€ç»ˆç®¡ç†å†³ç­–æƒ</li>
                        <li>ç³»ç»Ÿç»“æœä»…ä½œä¸ºç®¡ç†å‚è€ƒä¾æ®</li>
                        <li>æœ€ç»ˆè§£é‡Šæƒå½’å…¬å¸ç®¡ç†å±‚æ‰€æœ‰</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Original Intro Card (Menu View) -->
        <div class="intro-wrapper">
            <div class="intro-card" id="menu-view">
                <div style="text-align:center; margin-bottom:1rem;">
                    <h1 style="color: var(--primary-color); margin-bottom: 0.5rem; font-size: 1.8rem;">å•†ä¸šæŠ¥ä»·å†³ç­–ä¸é£é™©è¯„ä¼°ç³»ç»Ÿ V5.1</h1>
                    <h2 style="font-size: 1.2rem; color: var(--text-light); margin-bottom: 2rem;">æŠ¥ä»·å†³ç­–å®éªŒå®¤</h2>
                </div>
                
                <!-- Mode Selection Buttons -->
                <div class="mode-selector">
                    <button class="mode-btn" onclick="game.showManual()">
                        <span class="mode-label">æŸ¥çœ‹ç³»ç»Ÿè¯´æ˜ä¹¦</span>
                        <span class="mode-desc">é˜…è¯»ç³»ç»ŸèƒŒæ™¯ã€è§„åˆ™åŠæƒé™è¯´æ˜</span>
                        <span class="mode-desc-secondary">Read Manual</span>
                    </button>
                </div>

                <div class="level-grid">
                    <div class="level-box lvl-1">
                        <h4 style="color:#065f46">Level 1ï½œåŸºç¡€çº§</h4>
                        <span style="font-size:0.85rem">é¿å…æ˜æ˜¾æŠ¥ä»·é”™è¯¯<br>å»ºç«‹åŸºæœ¬é£é™©æ„è¯†</span>
                    </div>
                    <div class="level-box lvl-2">
                        <h4 style="color:#92400e">Level 2ï½œç†Ÿç»ƒçº§</h4>
                        <span style="font-size:0.85rem">åœ¨ä»·æ ¼ã€é£é™©ä¸æˆäº¤æ¦‚ç‡<br>ä¹‹é—´è¿›è¡Œæƒè¡¡</span>
                    </div>
                    <div class="level-box lvl-3">
                        <h4 style="color:#991b1b">Level 3ï½œéª¨å¹²çº§</h4>
                        <span style="font-size:0.85rem">å…·å¤‡ç³»ç»Ÿæ€§é£é™©æ§åˆ¶<br>ä¸å¤æ‚åœºæ™¯åˆ¤æ–­èƒ½åŠ›</span>
                    </div>
                </div>

                <div style="margin-bottom: 0; font-size: 0.9rem; color: var(--text-main); text-align: left; background: #f1f5f9; padding: 1.5rem; border-radius: 8px;">
                    <p style="margin-bottom: 1rem;"><strong>ç³»ç»ŸåŠŸèƒ½è¯´æ˜ï¼š</strong></p>
                    <ul style="margin-left: 1.5rem;">
                        <li><strong>åŠ¨æ€é£é™©æç¤ºï¼š</strong> é’ˆå¯¹å†³ç­–é”™è¯¯æä¾›å®æ—¶è­¦å‘Šï¼ˆä»…è®­ç»ƒæ¨¡å¼ï¼‰ã€‚</li>
                        <li><strong>ç»“æœæ¨¡æ‹Ÿï¼š</strong> é¢„æµ‹æŠ¥ä»·åœ¨ç°å®å•†åŠ¡ä¸­çš„å¯èƒ½åæœã€‚</li>
                        <li><strong>ç»¼åˆè¯„ä¼°ï¼š</strong> å¤šç»´åº¦åˆ†ææŠ¥ä»·å†³ç­–èƒ½åŠ›ä¸é£é™©æ§åˆ¶æ°´å¹³ã€‚</li>
                        <li><strong>ä¸¥æ ¼è€ƒæ ¸ï¼š</strong> è¯„ä¼°æ¨¡å¼ä¸‹å¼ºåˆ¶åŒ…å«é«˜é£é™©åœºæ™¯ï¼Œé˜²æ­¢è¿æ°”è¿‡å…³ã€‚</li>
                    </ul>
                </div>
            </div>

            <!-- MOVED START BUTTON OUTSIDE menu-view -->
            <!-- This ensures the button remains visible and clickable regardless of menu state toggles -->
            <button class="btn-primary" style="max-width: 300px; margin: 0 auto; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);" onclick="game.start()">
                å¼€å§‹è¯„ä¼° (Start Assessment)
            </button>
        </div>
    </div>

    <!-- Main Game Interface -->
    <header id="game-header" class="game-header">
        <div class="brand">
            <h1>æŠ¥ä»·å†³ç­–å®éªŒå®¤</h1>
            <span>å•†ä¸šæŠ¥ä»·å†³ç­–ä¸é£é™©è¯„ä¼°ç³»ç»Ÿ</span>
        </div>
        <div class="game-status">
            <div class="mode-display" id="mode-display">è®­ç»ƒæ¨¡å¼</div>
            <div class="level-badge l1" id="level-badge">Level 1</div>
            <div class="status-item">åœºæ™¯: <strong id="round-display">1/3</strong></div>
        </div>
    </header>

    <main id="game-main" class="game-main">
        <!-- Left: Inquiry Info -->
        <section class="card">
            <div class="card-header">
                <div class="card-title">ğŸ“„ å®¢æˆ·è¯¢ä»·å•</div>
                <div style="font-size:0.8rem; color:var(--text-light)" id="scenario-id">L1-01</div>
            </div>
            
            <div id="inquiry-container">
                <!-- Content injected by JS -->
            </div>

            <!-- Mentor Hint: Hidden in Assessment Mode -->
            <div id="mentor-container" style="margin-top: 1rem; padding: 1rem; background: #fff7ed; border-left: 4px solid #f97316; font-size: 0.85rem; color: #9a3412;">
                <strong>ğŸ’¡ é£é™©æç¤ºï¼ˆä»…è®­ç»ƒæ¨¡å¼æ˜¾ç¤ºï¼‰ï¼š</strong> <span id="mentor-hint">Loading...</span>
            </div>
        </section>

        <!-- Right: Decision Making -->
        <section class="card">
            <div class="card-header">
                <div class="card-title">ğŸ¯ æŠ¥ä»·å†³ç­–</div>
            </div>

            <!-- Step 1: Strategy -->
            <div>
                <label style="font-weight: 600; font-size: 0.95rem; display: block; margin-bottom: 0.5rem;">Step 1ï¼šé€‰æ‹©æŠ¥ä»·ç­–ç•¥</label>
                <div class="strategy-options">
                    <div class="strategy-btn" onclick="game.selectStrategy('aggressive', this)">
                        <h4>æ¿€è¿›å‹ç­–ç•¥</h4>
                        <p>ä»¥æé«˜ä¸­æ ‡æ¦‚ç‡ä¸ºä¼˜å…ˆ<br>æ¥å—è¾ƒä½åˆ©æ¶¦ç©ºé—´</p>
                    </div>
                    <div class="strategy-btn" onclick="game.selectStrategy('balanced', this)">
                        <h4>å¹³è¡¡å‹ç­–ç•¥</h4>
                        <p>åœ¨åˆ©æ¶¦ã€é£é™©ä¸æˆäº¤æ¦‚ç‡<br>ä¹‹é—´ä¿æŒå¹³è¡¡</p>
                    </div>
                    <div class="strategy-btn" onclick="game.selectStrategy('conservative', this)">
                        <h4>ä¿å®ˆå‹ç­–ç•¥</h4>
                        <p>ä»¥é£é™©æ§åˆ¶ä¸åˆ©æ¶¦å®‰å…¨ä¸ºä¼˜å…ˆ<br>é™ä½ä¸­æ ‡æ¦‚ç‡</p>
                    </div>
                </div>
            </div>

            <!-- Step 2: Conditions -->
            <div style="margin-top: 1.5rem;">
                <label style="font-weight: 600; font-size: 0.95rem; display: block; margin-bottom: 0.5rem;">Step 2ï¼šé£é™©æ§åˆ¶æ¡æ¬¾é€‰æ‹©</label>
                <div class="checkbox-group">
                    <label class="checkbox-label" onchange="game.updateMentorHint()">
                        <input type="checkbox" value="validity"> æŠ¥ä»·æœ‰æ•ˆæœŸè¯´æ˜
                    </label>
                    <label class="checkbox-label" onchange="game.updateMentorHint()">
                        <input type="checkbox" value="payment_spec"> æ˜ç¡®ä»˜æ¬¾æ¡ä»¶
                    </label>
                    <label class="checkbox-label" onchange="game.updateMentorHint()">
                        <input type="checkbox" value="tech_clarify"> è¡¥å……/ç¡®è®¤æŠ€æœ¯å‚æ•°
                    </label>
                    <label class="checkbox-label" onchange="game.updateMentorHint()">
                        <input type="checkbox" value="delivery_cond"> äº¤æœŸä»¥è®¢å•ç¡®è®¤æˆ–æŠ€æœ¯æ¾„æ¸…ä¸ºå‰æ
                    </label>
                </div>
                <!-- Disclaimer for logic -->
                <div class="policy-note">
                    è¯´æ˜ï¼šç³»ç»Ÿå°†æ ¹æ®å®¢æˆ·ä¿¡æ¯å®Œæ•´æ€§ä¸é£é™©ç­‰çº§ï¼Œè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦å­˜åœ¨â€œå¿…é¡»è¡¥å……çš„é£é™©æ§åˆ¶æ¡æ¬¾â€ã€‚éƒ¨åˆ†æ¡æ¬¾åœ¨ç‰¹å®šåœºæ™¯ä¸‹ä¸ºå¿…é€‰é¡¹ï¼Œæœªé€‰æ‹©å°†ç›´æ¥å½±å“é£é™©è¯„åˆ†ã€‚
                </div>
            </div>

            <!-- Step 3: Explanation -->
            <div style="margin-top: 1.5rem; flex: 1;">
                <label style="font-weight: 600; font-size: 0.95rem; display: block; margin-bottom: 0.5rem;">Step 3ï¼šæŠ¥ä»·å†³ç­–è¯´æ˜ï¼ˆéœ€ä½“ç°å› æœé€»è¾‘ï¼‰</label>
                <textarea id="user-explanation" placeholder="è¯·è¯´æ˜ï¼š&#10;â€¢ é€‰æ‹©è¯¥æŠ¥ä»·ç­–ç•¥çš„ä¸»è¦åŸå› &#10;â€¢ é£é™©ç‚¹è¯†åˆ«åŠåº”å¯¹æ–¹å¼&#10;â€¢ ä»·æ ¼ã€é£é™©ä¸æˆäº¤æ¦‚ç‡ä¹‹é—´çš„åˆ¤æ–­é€»è¾‘"></textarea>
            </div>

            <div class="action-area">
                <button id="submit-btn" class="btn-primary" onclick="game.submitQuote()" disabled>æäº¤æŠ¥ä»·å†³ç­–</button>
            </div>
        </section>
    </main>

    <!-- Summary Screen (Hidden by default) -->
    <div id="summary-screen" class="summary-screen">
        <div class="summary-container">
            <div class="summary-header">
                <h1 style="color: var(--primary-color);">æœ¬æ¬¡æŠ¥ä»·èƒ½åŠ›è¯„ä¼°ç»“æœ</h1>
                <p style="color: var(--text-light); margin-top: 0.5rem;">æŠ¥ä»·å†³ç­–èƒ½åŠ›ä¸é£é™©æ§åˆ¶ç»¼åˆåˆ†æ</p>
            </div>

            <div id="summary-content">
                <!-- JS Generated Content -->
            </div>
        </div>
    </div>

    <!-- Feedback Modal (Single Question) -->
    <div class="modal-overlay" id="feedback-modal">
        <div class="modal-content">
            <div class="score-circle">
                <div class="score-number" id="modal-score">0</div>
                <div class="score-total">/ 100</div>
            </div>

            <h3 style="text-align: center; margin-bottom: 1.5rem; font-weight: 600;">è¯„ä¼°åé¦ˆ</h3>

            <!-- Assessment Disclaimer -->
            <div id="assessment-disclaimer" style="display:none; font-size: 0.8rem; color: var(--text-light); margin-bottom: 1rem; text-align: center; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem;">
                è¯´æ˜ï¼šè¯„ä¼°æ¨¡å¼ä¸‹ä¸å±•ç¤ºè¿‡ç¨‹æ€§è¯„åˆ†ï¼Œä»…å±•ç¤ºæœ€ç»ˆç»“è®ºã€‚
            </div>

            <div id="feedback-container">
                <!-- Dynamic feedback blocks injected here -->
            </div>
            
            <div class="score-breakdown" id="detail-scores" style="margin-top: 1.5rem; border-top: 1px solid #e2e8f0; padding-top: 1rem;">
                <div class="breakdown-item"><span>ç­–ç•¥è¯„åˆ†:</span> <strong id="score-strategy">0/30</strong></div>
                <div class="breakdown-item"><span>é£æ§è¯„åˆ†:</span> <strong id="score-risk">0/25</strong></div>
                <div class="breakdown-item"><span>æ¡æ¬¾è¯„åˆ†:</span> <strong id="score-conditions">0/15</strong></div>
                <div class="breakdown-item"><span>é€»è¾‘è¯„åˆ†:</span> <strong id="score-explanation">0/30</strong></div>
            </div>

            <div style="margin-top: 2rem;">
                <button class="next-btn" id="next-round-btn" onclick="game.nextRound()">ä¸‹ä¸€é¢˜</button>
                <button class="next-btn btn-restart" id="finish-btn" onclick="game.finish()" style="display: none;">æŸ¥çœ‹æœ€ç»ˆæŠ¥å‘Š</button>
            </div>
        </div>
    </div>

    <footer id="game-footer">
        <p>Â© 2025 è¥¿å®‰æ³°é‡‘æ–°èƒ½æºç§‘æŠ€æœ‰é™å…¬å¸ - å†…éƒ¨æŠ¥ä»·èƒ½åŠ›è¯„ä¼°ç³»ç»Ÿ V5.1</p>
    </footer>

    <script>
        /**
         * Scenarios Database (30 Cases) - Data remains EN for Logic, UI displays CN mapped data if needed.
         */
        const scenarios = [
            // --- Level 1: Novice ---
            { id: "L1-01", level: 1, customer: "European EPC Contractor", application: "Oil & Gas Pipeline CP", product: "MMO Tubular Anodes", quantity: "120 pcs", delivery: "8â€“10 weeks", payment: "Not specified", targetPrice: "Comparing suppliers", additionalInfo: "Project-based EPC, limited technical details", hint: "æœªæŒ‡å®šä»˜æ¬¾æ¡æ¬¾æ˜¯ä¸»è¦æ½œåœ¨é£é™©ã€‚", logic: { riskLevel: "high", optimalStrategy: "balanced", requiredConditions: ["payment_spec"], bonusConditions: ["tech_clarify"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-02", level: 1, customer: "Eastern Europe CP Service", application: "Pipeline Maintenance", product: "MMO Ribbon Anodes", quantity: "2,000 m", delivery: "6â€“8 weeks", payment: "T/T 30% advance, 70% before shipment", targetPrice: "Price sensitive", additionalInfo: "Repeat purchasing history", hint: "é•¿æœŸåˆä½œå¹¶ä¸ä»£è¡¨å¯ä»¥æ”¾å¼ƒåˆ©æ¶¦ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: [], bonusConditions: ["validity"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-03", level: 1, customer: "SE Asia Infrastructure EPC", application: "Bridge CP", product: "MMO Plate Anodes", quantity: "200 pcs", delivery: "8 weeks", payment: "Not specified", targetPrice: "Lowest price preferred", additionalInfo: "Highly price-driven project", hint: "ä½ä»·é¡¹ç›®ä»éœ€ä¿éšœåº•çº¿åˆ©æ¶¦ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-04", level: 1, customer: "European CP Distributor", application: "Stock Supply", product: "Standard MMO Anodes", quantity: "Rolling orders", delivery: "Rolling delivery", payment: "T/T 30 days", targetPrice: "Margin focused", additionalInfo: "Multiple suppliers available", hint: "åˆ†é”€å•†é‡è§†ç¨³å®šæ€§ä¸æ¸…æ™°åº¦ã€‚", logic: { riskLevel: "low", optimalStrategy: "balanced", requiredConditions: [], bonusConditions: ["validity"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-05", level: 1, customer: "Pool System Integrator", application: "Pool Disinfection", product: "Small Hypochlorite Generator", quantity: "20 units", delivery: "4â€“6 weeks", payment: "T/T before shipment", targetPrice: "Price sensitive", additionalInfo: "Standard configuration", hint: "æ ‡å‡†åŒ–å¸‚åœºå…è®¸æœ‰é™åº¦çš„æ¿€è¿›æŠ¥ä»·ã€‚", logic: { riskLevel: "low", optimalStrategy: "aggressive", requiredConditions: [], bonusConditions: ["validity"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-06", level: 1, customer: "Asia Water Treatment EPC", application: "Municipal Disinfection", product: "Water Treatment MMO Anodes", quantity: "1 project set", delivery: "10â€“12 weeks", payment: "Not specified", targetPrice: "Budget limited", additionalInfo: "First cooperation", hint: "é¦–å•éœ€è¦è°¨æ…ï¼Œè€ŒéèµŒåšã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["payment_spec"], bonusConditions: ["tech_clarify"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-07", level: 1, customer: "South America Oilfield Supp", application: "Tank Bottom CP", product: "MMO Canister Anodes", quantity: "60 pcs", delivery: "Flexible", payment: "T/T before shipment", targetPrice: "Comparing local suppliers", additionalInfo: "Logistics uncertainty", hint: "ç‰©æµé£é™©åº”è®¡å…¥æˆæœ¬ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["delivery_cond"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-08", level: 1, customer: "European Municipal EPC", application: "Drinking Water", product: "Cell + MMO Anodes", quantity: "1 system", delivery: "12 weeks", payment: "Tender based, not finalized", targetPrice: "Budget controlled", additionalInfo: "Tender documentation heavy", hint: "åœ¨èŒƒå›´æ˜ç¡®å‰ï¼Œåˆ‡å‹¿é”å®šä»·æ ¼ã€‚", logic: { riskLevel: "high", optimalStrategy: "balanced", requiredConditions: ["tech_clarify"], bonusConditions: ["payment_spec"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-09", level: 1, customer: "Existing CP Customer", application: "Routine Replacement", product: "MMO Tubular Anodes", quantity: "40 pcs", delivery: "6 weeks", payment: "As previous orders", targetPrice: "Expect similar price", additionalInfo: "Stable relationship", hint: "ä¸€è‡´æ€§æ¯”å‹æ¦¨åˆ©æ¶¦æ›´é‡è¦ã€‚", logic: { riskLevel: "low", optimalStrategy: "balanced", requiredConditions: [], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L1-10", level: 1, customer: "Unknown Client", application: "CP System (Unclear)", product: "MMO Anodes", quantity: "Not specified", delivery: "Urgent", payment: "Not mentioned", targetPrice: "As low as possible", additionalInfo: "Very limited information", hint: "ä¿¡æ¯ç¼ºå¤±ç­‰äºæœ€å¤§é£é™©ã€‚", logic: { riskLevel: "high", optimalStrategy: "balanced", requiredConditions: ["tech_clarify", "payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            // --- Level 2: Skilled ---
            { id: "L2-11", level: 2, customer: "Middle East Oil EPC", application: "Onshore Pipeline CP", product: "Deep Groundbed Anodes", quantity: "1 complete set", delivery: "12â€“16 weeks", payment: "Milestone (not finalized)", targetPrice: "Under review", additionalInfo: "Strict inspection required", hint: "å¤§å‹é¡¹ç›®ä¼šæ”¾å¤§å°é”™è¯¯çš„å½±å“ã€‚", logic: { riskLevel: "high", optimalStrategy: "conservative", requiredConditions: ["payment_spec", "delivery_cond"], bonusConditions: ["tech_clarify"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L2-12", level: 2, customer: "Eastern Europe CP Cont", application: "Pipeline CP Install", product: "MMO Tubular Anodes", quantity: "90 pcs", delivery: "8 weeks", payment: "T/T 30% adv, bal on del", targetPrice: "Competitor price avail", additionalInfo: "Project award pending", hint: "èµ¢å–é¡¹ç›®ä¸ç­‰äºè·å–åˆ©æ¶¦ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: [], bonusConditions: ["validity"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L2-13", level: 2, customer: "European Water OEM", application: "Equipment Integration", product: "Electro-Chlorination Cell", quantity: "50 units/yr", delivery: "Rolling delivery", payment: "Net 45 days", targetPrice: "Target cost required", additionalInfo: "Potential long-term agreement", hint: "OEM ä¸šåŠ¡å¥–åŠ±çš„æ˜¯ç¨³å®šæ€§ï¼Œè€Œéä¸€æ¬¡æ€§åˆ©æ¶¦ã€‚", logic: { riskLevel: "medium", optimalStrategy: "aggressive", requiredConditions: ["validity"], bonusConditions: [], forbiddenConditions: ["delivery_cond"], competitorPressure: true } },
            { id: "L2-14", level: 2, customer: "LatAm Industrial EPC", application: "Ind. Wastewater", product: "MMO Anodes", quantity: "Project-based", delivery: "10â€“14 weeks", payment: "Not specified", targetPrice: "Budget sensitive", additionalInfo: "Technical params not defined", hint: "èŒƒå›´ä¸æ¸… + ä»˜æ¬¾ä¸æ˜ = åŒé‡é£é™©ã€‚", logic: { riskLevel: "high", optimalStrategy: "balanced", requiredConditions: ["tech_clarify", "payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L2-15", level: 2, customer: "Asian Li-Battery Maker", application: "Copper Foil Pilot", product: "DSA Anodes", quantity: "Pilot line set", delivery: "8â€“10 weeks", payment: "T/T 30% adv, 70% accept", targetPrice: "Benchmarking multi", additionalInfo: "High tech requirements", hint: "è¯•äº§çº¿å†³å®šæœªæ¥äº§é‡ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["tech_clarify"], bonusConditions: ["validity"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L2-16", level: 2, customer: "Euro Copper Equip Integrator", application: "Copper Foil Line", product: "Anodes + Cells", quantity: "1 line", delivery: "Project based", payment: "Milestone", targetPrice: "Integrated pricing", additionalInfo: "Long cycle, coordination needed", hint: "ç³»ç»Ÿé¡¹ç›®ä¼šæƒ©ç½šæŠ¥ä»·è¿‡ä½ã€‚", logic: { riskLevel: "high", optimalStrategy: "conservative", requiredConditions: ["delivery_cond", "payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L2-17", level: 2, customer: "ME Water Authority", application: "Sea Water Electro", product: "Sea Water System", quantity: "Multiple units", delivery: "16â€“20 weeks", payment: "Gov payment (pending)", targetPrice: "Competitive tender", additionalInfo: "Strict compliance", hint: "åˆè§„éœ€è¦æˆæœ¬ã€‚è¯·å°†å…¶è®¡å…¥ä»·æ ¼ã€‚", logic: { riskLevel: "critical", optimalStrategy: "conservative", requiredConditions: ["tech_clarify", "payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L2-18", level: 2, customer: "North Am Eng Firm", application: "Adv Water R&D", product: "MMO Mesh Anodes", quantity: "Small batch", delivery: "Urgent (2 weeks)", payment: "Net 30 (pending credit)", targetPrice: "Not mentioned", additionalInfo: "Design subject to change", hint: "ç´§æ€¥æ˜¯æˆæœ¬é©±åŠ¨å› ç´ ï¼Œè€Œéæ©æƒ ã€‚", logic: { riskLevel: "high", optimalStrategy: "conservative", requiredConditions: ["payment_spec", "delivery_cond"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L2-19", level: 2, customer: "SE Asia Hydromet Owner", application: "Electrowinning", product: "MMO/DSA Anodes", quantity: "Project-based", delivery: "12 weeks", payment: "Not specified", targetPrice: "Budget discussion", additionalInfo: "Process params unclear", hint: "å·¥è‰ºä¸ç¡®å®šæ€§å¿…é¡»æ¾„æ¸…ã€‚", logic: { riskLevel: "high", optimalStrategy: "balanced", requiredConditions: ["tech_clarify", "payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L2-20", level: 2, customer: "Existing Ind. Client", application: "Upgraded Process", product: "Custom MMO Anodes", quantity: "50 pcs", delivery: "8 weeks", payment: "As per previous", targetPrice: "Expect similar price", additionalInfo: "Higher current density", hint: "ç›¸åŒå®¢æˆ·ä¸ä»£è¡¨ç›¸åŒæˆæœ¬ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["tech_clarify"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            // --- Level 3: Expert ---
            { id: "L3-21", level: 3, customer: "North Am Tech Startup", application: "Adv Electrochem R&D", product: "Platinized Ti Anodes", quantity: "Small batch", delivery: "ASAP (1-2 weeks)", payment: "Net 60 (no credit)", targetPrice: "Not mentioned", additionalInfo: "Frequent spec changes", hint: "å¼ºåŠ²çš„æŠ€æœ¯å¹¶ä¸ä¿è¯ä»˜æ¬¾ã€‚", logic: { riskLevel: "critical", optimalStrategy: "conservative", requiredConditions: ["payment_spec", "delivery_cond", "tech_clarify"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L3-22", level: 3, customer: "African Gov Project", application: "Municipal CP + Water", product: "Anodes + System", quantity: "Project-based", delivery: "TBD", payment: "Gov funding (unclear)", targetPrice: "Budget capped", additionalInfo: "Multiple approval layers", hint: "æ”¿æ²»é¡¹ç›®éšè—ç€å•†ä¸šé£é™©ã€‚", logic: { riskLevel: "critical", optimalStrategy: "conservative", requiredConditions: ["payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L3-23", level: 3, customer: "Global Strategic Client", application: "Multi-Project CP", product: "Multiple Anodes", quantity: "Annual agreement", delivery: "Rolling delivery", payment: "Quarterly settlement", targetPrice: "Y-O-Y reduction expected", additionalInfo: "High volume", hint: "æ¡†æ¶åè®®æ˜¯ç”¨åˆ©æ¶¦äº¤æ¢ç¨³å®šæ€§ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["validity"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L3-24", level: 3, customer: "Existing Key Client", application: "Emergency CP Replace", product: "MMO Tubular Anodes", quantity: "30 pcs", delivery: "2 weeks (urgent)", payment: "As per contract", targetPrice: "Expect same price", additionalInfo: "Production under pressure", hint: "ç´§æ€¥æ˜¯é™„åŠ è´¹ç”¨ï¼Œè€Œéæ©æƒ ã€‚", logic: { riskLevel: "high", optimalStrategy: "conservative", requiredConditions: ["delivery_cond"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L3-25", level: 3, customer: "Euro Research Inst", application: "Material Research", product: "Custom MMO Anodes", quantity: "Prototype", delivery: "Flexible", payment: "Grant-based", targetPrice: "Cost transparency", additionalInfo: "Non-commercial criteria", hint: "ç ”ç©¶é¡¹ç›®ä¸æ˜¯æ ‡å‡†é”€å”®ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["tech_clarify"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L3-26", level: 3, customer: "Asian Copper Foil Maker", application: "High-Speed Foil Line", product: "DSA Anodes", quantity: "Full production line", delivery: "Project based", payment: "Milestone", targetPrice: "Benchmarking global", additionalInfo: "Failure impacts entire line", hint: "è¿™é‡Œä¸€ä¸ªé”™è¯¯å°±ä¼šé€ æˆæ•°ç™¾ä¸‡æŸå¤±ã€‚", logic: { riskLevel: "critical", optimalStrategy: "conservative", requiredConditions: ["tech_clarify", "payment_spec", "delivery_cond"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L3-27", level: 3, customer: "Japanese Equipment Int", application: "Precision Process", product: "High-Spec MMO", quantity: "Custom batch", delivery: "Strict schedule", payment: "Net 60 days", targetPrice: "Quality prioritized", additionalInfo: "Extensive qual process", hint: "æ—¥æœ¬é¡¹ç›®å¥–åŠ±çš„æ˜¯ç²¾åº¦ï¼Œè€Œéé€Ÿåº¦ã€‚", logic: { riskLevel: "high", optimalStrategy: "conservative", requiredConditions: ["tech_clarify"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            { id: "L3-28", level: 3, customer: "LatAm Mining Group", application: "Electrowinning", product: "MMO/DSA Anodes", quantity: "Large project", delivery: "14â€“18 weeks", payment: "Extended payment", targetPrice: "Negotiable", additionalInfo: "Complex approval", hint: "é•¿ä»˜æ¬¾å‘¨æœŸå¿…é¡»å®šä»·ã€‚", logic: { riskLevel: "high", optimalStrategy: "conservative", requiredConditions: ["payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L3-29", level: 3, customer: "Fast-Growing Overseas OEM", application: "Equip Manuf", product: "MMO Anodes", quantity: "Initial trial", delivery: "6 weeks", payment: "T/T 30% adv, 70% B/L", targetPrice: "Aggressive target", additionalInfo: "Claims future large volume", hint: "æœªæ¥æ‰¿è¯ºä¸åº”æŠµæ¶ˆå½“å‰é£é™©ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["validity"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L3-30", level: 3, customer: "Unknown Trading Co", application: "CP/Water (Unclear)", product: "MMO Anodes", quantity: "Unclear", delivery: "Urgent", payment: "Not mentioned", targetPrice: "Extremely low", additionalInfo: "Refuses details", hint: "ä¸æ˜¯æ‰€æœ‰è¯¢ä»·éƒ½å€¼å¾—æŠ¥ä»·ã€‚", logic: { riskLevel: "critical", optimalStrategy: "conservative", requiredConditions: ["payment_spec", "tech_clarify"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } }
        ];

        /**
         * Game Engine V5.1 (CN) Fixed
         */
        const game = {
            mode: 'training',
            currentRound: 0,
            sessionScenarios: [],
            sessionResults: [], 
            currentScenario: null,
            selectedStrategy: null,
            
            elements: {
                intro: document.getElementById('intro-screen'),
                menuView: document.getElementById('menu-view'),
                manualView: document.getElementById('manual-view'),
                gameHeader: document.getElementById('game-header'),
                gameMain: document.getElementById('game-main'),
                gameFooter: document.getElementById('game-footer'),
                summaryScreen: document.getElementById('summary-screen'),
                roundDisplay: document.getElementById('round-display'),
                modeDisplay: document.getElementById('mode-display'),
                levelBadge: document.getElementById('level-badge'),
                scenarioId: document.getElementById('scenario-id'),
                inquiryContainer: document.getElementById('inquiry-container'),
                mentorContainer: document.getElementById('mentor-container'),
                mentorHint: document.getElementById('mentor-hint'),
                strategyBtns: document.querySelectorAll('.strategy-btn'),
                submitBtn: document.getElementById('submit-btn'),
                explanation: document.getElementById('user-explanation'),
                modal: document.getElementById('feedback-modal'),
                assessmentDisclaimer: document.getElementById('assessment-disclaimer'),
                feedbackContainer: document.getElementById('feedback-container'),
                nextBtn: document.getElementById('next-round-btn'),
                finishBtn: document.getElementById('finish-btn'),
                detailScores: document.getElementById('detail-scores'),
                scoreDetails: {
                    strategy: document.getElementById('score-strategy'),
                    risk: document.getElementById('score-risk'),
                    conditions: document.getElementById('score-conditions'),
                    explanation: document.getElementById('score-explanation')
                }
            },

            // Switch to Manual View
            showManual: function() {
                this.elements.manualView.classList.add('active');
            },

            // Back to Menu View
            backToMenu: function() {
                this.elements.manualView.classList.remove('active');
            },

            pickRandomScenarios: function() {
                if (this.mode === 'assessment') {
                    // 1. å¿…é¡»åŒ…å« 1 ä¸ª L3 Critical (é£é™©åº•çº¿)
                    const l3Crit = scenarios.filter(s => s.level === 3 && s.logic.riskLevel === 'critical');
                    const pickL3 = l3Crit[Math.floor(Math.random() * l3Crit.length)];

                    // 2. å¿…é¡»åŒ…å« 1 ä¸ª Payment/Delivery ä¸æ¸… (å›æ¬¾æ„è¯†)
                    const unclearRisk = scenarios.filter(s => 
                        (s.payment.includes('Not') || s.payment.includes('Unclear') || s.payment.includes('Pending') || s.delivery.includes('Urgent')) 
                        && s.id !== pickL3.id
                    );
                    let pickRisk;
                    if (unclearRisk.length > 0) {
                        pickRisk = unclearRisk[Math.floor(Math.random() * unclearRisk.length)];
                    } else {
                        pickRisk = scenarios.filter(s => s.id !== pickL3.id)[Math.floor(Math.random() * 29)];
                    }

                    // 3. ç¬¬ 3 é¢˜éšæœº
                    const remaining = scenarios.filter(s => s.id !== pickL3.id && s.id !== pickRisk.id);
                    const pickFill = remaining[Math.floor(Math.random() * remaining.length)];

                    return [pickL3, pickRisk, pickFill].sort(() => 0.5 - Math.random());
                } else {
                    return scenarios.sort(() => 0.5 - Math.random()).slice(0, 3);
                }
            },

            start: function() {
                // Prompt for mode selection (Simple for this demo: Default to Training)
                // In a full app, this would be a modal. Here we set a default or check a hidden var.
                // Let's assume Training for simplicity, or add a quick prompt.
                const isAssessment = confirm("ç‚¹å‡» [ç¡®å®š] è¿›å…¥ è¯„ä¼°æ¨¡å¼\nç‚¹å‡» [å–æ¶ˆ] è¿›å…¥ è®­ç»ƒæ¨¡å¼");
                this.mode = isAssessment ? 'assessment' : 'training';
                this.sessionResults = []; 

                // UI Transition
                this.elements.intro.style.display = 'none';
                this.elements.gameHeader.style.display = 'flex';
                this.elements.gameMain.style.display = 'grid';
                this.elements.gameFooter.style.display = 'block';

                this.sessionScenarios = this.pickRandomScenarios();
                this.loadRound(0);
            },

            loadRound: function(roundIndex) {
                this.currentRound = roundIndex;
                this.currentScenario = this.sessionScenarios[roundIndex];
                this.selectedStrategy = null;
                
                this.elements.roundDisplay.innerText = `${roundIndex + 1}/${this.sessionScenarios.length}`;
                this.elements.modeDisplay.innerText = this.mode === 'training' ? 'è®­ç»ƒæ¨¡å¼' : 'è¯„ä¼°æ¨¡å¼';
                this.elements.scenarioId.innerText = this.currentScenario.id;
                
                const lvl = this.currentScenario.level;
                this.elements.levelBadge.innerText = lvl === 1 ? "Level 1" : (lvl === 2 ? "Level 2" : "Level 3");
                this.elements.levelBadge.className = `level-badge l${lvl}`;

                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                this.elements.explanation.value = "";
                this.elements.strategyBtns.forEach(btn => btn.classList.remove('selected'));
                this.elements.submitBtn.disabled = true;

                const s = this.currentScenario;
                const html = `
                    <div class="inquiry-paper">
                        <div class="data-row"><span class="data-label">å®¢æˆ·ç±»å‹:</span><span class="data-value">${s.customer}</span></div>
                        <div class="data-row"><span class="data-label">åº”ç”¨åœºæ™¯:</span><span class="data-value">${s.application}</span></div>
                        <div class="data-row"><span class="data-label">äº§å“ç±»å‹:</span><span class="data-value">${s.product}</span></div>
                        <div class="data-row"><span class="data-label">æ•°é‡:</span><span class="data-value">${s.quantity}</span></div>
                        <div class="data-row"><span class="data-label">äº¤æœŸè¦æ±‚:</span><span class="data-value">${s.delivery}</span></div>
                        <div class="data-row"><span class="data-label">ä»˜æ¬¾æ¡ä»¶:</span><span class="data-value ${s.payment.includes('Not') || s.payment.includes('Unclear') || s.payment.includes('Pending') ? 'highlight-bad' : ''}">${s.payment}</span></div>
                        <div class="data-row"><span class="data-label">å®¢æˆ·ä»·æ ¼é¢„æœŸ:</span><span class="data-value">${s.targetPrice}</span></div>
                        <div class="data-row" style="border:none"><span class="data-label">è¡¥å……è¯´æ˜:</span><span class="data-value">${s.additionalInfo}</span></div>
                    </div>
                `;
                this.elements.inquiryContainer.innerHTML = html;

                if (this.mode === 'assessment') {
                    this.elements.mentorContainer.style.display = 'none';
                } else {
                    this.elements.mentorContainer.style.display = 'block';
                    this.elements.mentorHint.innerText = s.hint;
                    this.elements.mentorHint.style.color = "#9a3412";
                    this.elements.mentorContainer.style.borderColor = "#f97316";
                }
            },

            selectStrategy: function(strategy, btnElement) {
                this.selectedStrategy = strategy;
                this.elements.strategyBtns.forEach(b => b.classList.remove('selected'));
                btnElement.classList.add('selected');
                this.checkSubmitState();
                this.updateMentorHint();
            },

            updateMentorHint: function() {
                if (this.mode === 'assessment') return;
                const strategy = this.selectedStrategy;
                const checkedBoxes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
                const baseHint = this.currentScenario.hint;
                const logic = this.currentScenario.logic;
                
                let dynamicWarning = null;
                const hintEl = this.elements.mentorHint;
                const hintContainer = this.elements.mentorContainer;

                if (strategy === 'aggressive' && !checkedBoxes.includes('payment_spec')) {
                    dynamicWarning = "âš  é£é™©æç¤ºï¼šå½“å‰å®šä»·ç­–ç•¥æœªè¦†ç›–ä»˜æ¬¾é£é™©ã€‚";
                } 
                else if (logic.riskLevel === 'critical' && strategy !== 'conservative') {
                    dynamicWarning = "âš  é£é™©æç¤ºï¼šå…³é”®é£é™©åœºæ™¯è¦æ±‚é‡‡ç”¨ä¿å®ˆå‹å®šä»·ã€‚";
                }
                else if (this.currentScenario.level === 2 && logic.optimalStrategy === 'aggressive' && strategy === 'balanced') {
                    dynamicWarning = "âš  é£é™©æç¤ºï¼šæ­¤OEMåœºæ™¯æ›´é€‚åˆæ¿€è¿›å®šä»·ä»¥æ¢å–é•¿æœŸåˆä½œã€‚";
                }

                if (dynamicWarning) {
                    hintEl.innerText = dynamicWarning;
                    hintEl.style.color = "#ef4444";
                    hintContainer.style.borderColor = "#ef4444";
                } else {
                    hintEl.innerText = baseHint;
                    hintEl.style.color = "#9a3412";
                    hintContainer.style.borderColor = "#f97316";
                }
            },

            checkSubmitState: function() {
                const text = this.elements.explanation.value.trim();
                this.elements.submitBtn.disabled = !(this.selectedStrategy && text.length > 10);
            },

            submitQuote: function() {
                const result = this.calculateScore();
                
                this.sessionResults.push({
                    scenarioId: this.currentScenario.id,
                    level: this.currentScenario.level,
                    score: result.scores.total,
                    isBlocked: result.isManagementBlock,
                    detail: result.scores
                });

                this.showFeedback(result);
            },

            calculateScore: function() {
                const lvl = this.currentScenario.level;
                const logic = this.currentScenario.logic;
                const checkedBoxes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
                const explanationText = this.elements.explanation.value.toLowerCase();
                
                let scores = { strategy: 0, risk: 0, conditions: 0, explanation: 0, total: 0 };
                let feedback = [];
                let isManagementBlock = false;

                // Strategy Scoring
                if (lvl === 1) {
                    if (this.selectedStrategy === logic.optimalStrategy) scores.strategy = 30;
                    else if (this.selectedStrategy === 'balanced') scores.strategy = 25;
                    else scores.strategy = 10;
                    if (logic.riskLevel === 'high' && this.selectedStrategy === 'aggressive') {
                        scores.strategy = 10;
                        feedback.push({ type: 'error', title: 'æ–°æ‰‹é£é™©', msg: 'ä¸è¦åœ¨é«˜é£é™©é¡¹ç›®ä¸Šé‡‡ç”¨æ¿€è¿›çš„å®šä»·è¿›è¡ŒèµŒåšã€‚' });
                    }
                } else if (lvl === 2) {
                    if (this.selectedStrategy === logic.optimalStrategy) scores.strategy = 30;
                    else if (this.selectedStrategy === 'balanced') {
                        scores.strategy = 20;
                        feedback.push({ type: 'warning', title: 'é”™å¤±æœºä¼š', msg: 'å¹³è¡¡æ˜¯å®‰å…¨çš„ï¼Œä½†æ‚¨é”™è¿‡äº†æœ¬åœºæ™¯çš„æœ€ä½³æƒè¡¡ã€‚' });
                    } else {
                        scores.strategy = 10;
                    }
                } else {
                    if (this.selectedStrategy === logic.optimalStrategy) scores.strategy = 30;
                    else if (this.selectedStrategy === 'balanced') {
                        if (logic.riskLevel === 'critical') {
                            scores.strategy = 5;
                            feedback.push({ type: 'error', title: 'ä½ä¼°é£é™©', msg: 'åœ¨å…³é”®é£é™©åœºæ™¯ä¸­ï¼Œå¹³è¡¡ç­–ç•¥ä¾ç„¶è¿‡äºå±é™©ã€‚' });
                        } else {
                            scores.strategy = 15;
                        }
                    } else {
                        scores.strategy = 0;
                        isManagementBlock = true;
                        feedback.push({ type: 'error', title: 'ç®¡ç†å±‚å¦å†³', msg: 'åœ¨æ­¤åœºæ™¯ä¸‹ç¦æ­¢ä½¿ç”¨æ¿€è¿›å®šä»·ã€‚' });
                    }
                }

                // Risk Scoring
                let riskScore = 25;
                const missingRequired = logic.requiredConditions.filter(req => !checkedBoxes.includes(req));
                if (missingRequired.length > 0) {
                    riskScore -= (missingRequired.length * 10);
                    feedback.push({ type: 'warning', title: 'æœªä¿æŠ¤çš„é£é™©', msg: `ç¼ºå¤±æ¡æ¬¾: ${missingRequired.join(", ")}ã€‚` });
                }
                if (lvl === 3) {
                    if (missingRequired.length > 0) riskScore = 0;
                    if (logic.riskLevel === 'critical' && this.selectedStrategy !== 'conservative') riskScore = 0;
                }
                scores.risk = Math.max(0, riskScore);

                // Conditions Scoring
                let condScore = 10;
                if (checkedBoxes.length === 0) condScore = 0;
                const hitBonus = logic.bonusConditions.filter(b => checkedBoxes.includes(b));
                condScore += (hitBonus.length * 3);
                if (lvl >= 2) {
                    const hitForbidden = logic.forbiddenConditions.filter(f => checkedBoxes.includes(f));
                    if (hitForbidden.length > 0) {
                        condScore -= (hitForbidden.length * 10);
                        feedback.push({ type: 'warning', title: 'è¿‡åº¦æ§åˆ¶', msg: 'æ‚¨åœ¨æ­¤å¤„æ·»åŠ äº†æŸå®³äº¤æ˜“çµæ´»æ€§çš„æ¡æ¬¾ã€‚' });
                    }
                }
                scores.conditions = Math.max(0, Math.min(15, condScore));

                // Explanation Scoring (Chinese Logic Patterns)
                const logicPatterns = ["å› ä¸º", "ç”±äº", "å› æ­¤", "è€ƒè™‘åˆ°", "å¯¼è‡´", "åŸºäº", "ä¸ºäº†", "æ‰€ä»¥"];
                const hasLogic = logicPatterns.some(p => explanationText.includes(p));
                const keywords = ["æˆæœ¬", "é£é™©", "åˆ©æ¶¦", "ç«äº‰", "è´¨é‡", "å¸‚åœº", "äº¤æœŸ", "ä»˜æ¬¾"];
                let keywordCount = 0;
                keywords.forEach(k => { if (explanationText.includes(k)) keywordCount++; });

                if (explanationText.length < 20) {
                    scores.explanation = 5;
                    feedback.push({ type: 'warning', title: 'è¯´æ˜ä¸è¶³', msg: this.mode === 'assessment' ? 'å†³ç­–è¯´æ˜ä¸è¶³ï¼Œæ— æ³•æ”¯æ’‘æŠ¥ä»·åˆ¤æ–­ã€‚' : 'ç®¡ç†è€…éœ€è¦æ›´å¤šæ¨ç†ä¾æ®ã€‚' });
                } else {
                    scores.explanation = 10;
                    if (hasLogic) scores.explanation += 10;
                    else if (lvl >= 2 && keywordCount > 2) {
                        scores.explanation -= 5;
                        feedback.push({ type: 'warning', title: 'é€»è¾‘ç¼ºå¤±', msg: this.mode === 'assessment' ? 'å†³ç­–è¯´æ˜ç¼ºä¹æ˜ç¡®å› æœé€»è¾‘ã€‚' : 'æ‚¨åˆ—ä¸¾äº†å› ç´ ï¼Œä½†æœªè§£é‡Šå› æœè”ç³» (è¯·ä½¿ç”¨â€œå› ä¸ºâ€ã€â€œç”±äºâ€ç­‰è¯æ±‡)ã€‚' });
                    }
                    scores.explanation += Math.min(10, keywordCount * 2);
                }

                if (isManagementBlock) {
                    scores.total = Math.min(scores.total, 50);
                    feedback.unshift({ type: 'block', title: 'ç®¡ç†å±‚å¦å†³', msg: 'è¯¥æŠ¥ä»·å†³ç­–è¿åå…¬å¸é£é™©æ§åˆ¶è¦æ±‚ï¼Œä¸å…è®¸è¿›è¡Œç‹¬ç«‹æŠ¥ä»·ï¼Œéœ€æäº¤ç®¡ç†å±‚å®¡æ‰¹ã€‚' });
                } else {
                    scores.total = Math.min(100, scores.strategy + scores.risk + scores.conditions + scores.explanation);
                }

                // Outcome Simulation (Chinese)
                let outcome = "";
                if (isManagementBlock) {
                    outcome = "å·²è§¦å‘ç®¡ç†å±‚å¦å†³ã€‚é‚®ä»¶æœªå‘é€ã€‚";
                } else if (scores.total < 60) {
                    outcome = "æŠ¥ä»·å·²å‘é€ï¼Œä½†å†…éƒ¨å®¡æ‰¹å› åˆ©æ¶¦/é£é™©é—®é¢˜æœªé€šè¿‡ã€‚";
                } else if (scores.total < 80) {
                    outcome = "æŠ¥ä»·å·²å‘é€ï¼Œä½†å®¢æˆ·è¦æ±‚è¿›ä¸€æ­¥æ¾„æ¸…æˆ–è°ƒæ•´ã€‚";
                } else {
                    outcome = "æŠ¥ä»·é€šè¿‡å†…éƒ¨å®¡æ‰¹ï¼Œå…·å¤‡è°ˆåˆ¤ä¼˜åŠ¿ã€‚";
                }

                return { scores, feedback, outcome, isManagementBlock };
            },

            showFeedback: function(result) {
                const { scores, feedback, outcome, isManagementBlock } = result;
                
                document.getElementById('modal-score').innerText = scores.total;
                
                if (this.mode === 'assessment') {
                    this.elements.detailScores.style.display = 'none';
                    this.elements.assessmentDisclaimer.style.display = 'block';
                } else {
                    this.elements.detailScores.style.display = 'grid';
                    this.elements.assessmentDisclaimer.style.display = 'none';
                    this.elements.scoreDetails.strategy.innerText = `${scores.strategy}/30`;
                    this.elements.scoreDetails.risk.innerText = `${scores.risk}/25`;
                    this.elements.scoreDetails.conditions.innerText = `${scores.conditions}/15`;
                    this.elements.scoreDetails.explanation.innerText = `${scores.explanation}/30`;
                }

                let fbHtml = '';

                if (this.mode === 'assessment') {
                    let authStatus = "";
                    let authClass = "";
                    if (isManagementBlock) {
                        authStatus = "âŒ ä¸å…·å¤‡æŠ¥ä»·èµ„æ ¼";
                        authClass = "color: #ef4444; border-color: #ef4444;";
                    } else if (scores.total >= 80) {
                        authStatus = "âœ… æˆæƒé€šè¿‡";
                        authClass = "color: #10b981; border-color: #10b981;";
                    } else {
                        authStatus = "âš ï¸ éœ€å¤æ ¸";
                        authClass = "color: #f59e0b; border-color: #f59e0b;";
                    }

                    fbHtml += `
                        <div class="feedback-section authority" style="border:${authClass}">
                            <h4 style="margin-bottom:5px; font-size:1.1rem; ${authClass.split(';')[0]}">${authStatus}</h4>
                            <div style="font-size:0.85rem; opacity:0.8;">
                                ${isManagementBlock ? "ä¸å…è®¸ç‹¬ç«‹æŠ¥ä»·ã€‚" : (scores.total >= 80 ? "å…·å¤‡å½“å‰æˆæƒèŒƒå›´å†…çš„ç‹¬ç«‹æŠ¥ä»·èµ„æ ¼ã€‚" : "éœ€ä¸»ç®¡å¤æ ¸åæ–¹å¯ç‹¬ç«‹æŠ¥ä»·ã€‚")}
                            </div>
                        </div>
                    `;
                }

                // Outcome (Chinese Title)
                fbHtml += `<div class="feedback-section outcome"><span class="feedback-title" style="color:var(--primary-color)">ğŸ“‰ å¯èƒ½ç»“æœè¯„ä¼°</span>${outcome}</div>`;

                if (this.mode === 'training') {
                    feedback.forEach(f => {
                        fbHtml += `<div class="feedback-section ${f.type}"><span class="feedback-title">${f.title}</span>${f.msg}</div>`;
                    });
                    if (!isManagementBlock && scores.total >= 90) {
                        fbHtml += `<div class="feedback-section success"><span class="feedback-title">å†³ç­–ä¼˜ç§€</span>å®Œç¾å¹³è¡¡äº†é£é™©ä¸å›æŠ¥ã€‚</div>`;
                    }
                } else {
                    if (isManagementBlock) {
                        // Handled in Authority block
                    } else if (scores.total < 60) {
                        fbHtml += `<div class="feedback-section error"><span class="feedback-title">è¯„ä¼°ç»“è®º</span>å•†ä¸šæ„è¯†å°šéœ€æå‡ã€‚</div>`;
                    }
                }

                this.elements.feedbackContainer.innerHTML = fbHtml;
                this.elements.modal.classList.add('active');

                if (this.currentRound < this.sessionScenarios.length - 1) {
                    this.elements.nextBtn.style.display = 'block';
                    this.elements.finishBtn.style.display = 'none';
                } else {
                    this.elements.nextBtn.style.display = 'none';
                    this.elements.finishBtn.style.display = 'block';
                }
            },

            nextRound: function() {
                this.elements.modal.classList.remove('active');
                setTimeout(() => { this.loadRound(this.currentRound + 1); }, 300);
            },

            finish: function() {
                this.elements.modal.classList.remove('active');
                this.showSessionSummary();
            },

            showSessionSummary: function() {
                const results = this.sessionResults;
                const avg = Math.round(results.reduce((a,b)=>a+b.score,0) / results.length);
                const min = Math.min(...results.map(r=>r.score));
                const blockCount = results.filter(r=>r.isBlocked).length;

                const statsHtml = `
                    <div class="summary-module">
                        <div class="module-title">ğŸ“Š è¯„ä¼°æ¦‚è§ˆ</div>
                        <div class="stat-row"><span>æ¨¡å¼:</span> <span class="stat-value" style="text-transform:uppercase">${this.mode}</span></div>
                        <div class="stat-row"><span>æ€»é¢˜æ•°:</span> <span class="stat-value">${results.length}</span></div>
                        <div class="stat-row"><span>å¹³å‡åˆ†:</span> <span class="stat-value ${avg >= 80 ? 'green' : (avg < 60 ? 'red' : '')}">${avg} / 100</span></div>
                        <div class="stat-row"><span>æœ€ä½åˆ†:</span> <span class="stat-value ${min < 60 ? 'red' : ''}">${min} / 100</span></div>
                        <div class="stat-row"><span>ç®¡ç†å±‚å¦å†³:</span> <span class="stat-value ${blockCount > 0 ? 'red' : 'green'}">${blockCount}</span></div>
                    </div>
                `;

                let riskWarningHtml = '';
                const hasCriticalFail = results.some(r => r.isBlocked || r.score < 60);
                
                if (hasCriticalFail) {
                    riskWarningHtml = `
                        <div class="summary-module" style="border-color: var(--danger-color); background: #fef2f2;">
                            <div class="module-title" style="color: var(--danger-color)">ğŸš¨ æ£€æµ‹åˆ°å…³é”®é£é™©</div>
                            <p style="font-size: 0.9rem;">æ‚¨è‡³å°‘åœ¨ä¸€ä¸ªæ¶‰åŠä»˜æ¬¾æˆ–äº¤æœŸä¸ç¡®å®šçš„åœºæ™¯ä¸­ä½ä¼°äº†é£é™©ï¼Œæˆ–æœªè¾¾åˆ°æˆæƒè¦æ±‚ã€‚</p>
                        </div>
                    `;
                } else {
                    riskWarningHtml = `
                        <div class="summary-module" style="border-color: var(--success-color); background: #f0fdf4;">
                            <div class="module-title" style="color: var(--success-color)">âœ… é£é™©æ§åˆ¶ä¸€è‡´æ€§è‰¯å¥½</div>
                            <p style="font-size: 0.9rem;">æœªæ£€æµ‹åˆ°å…³é”®å¦å†³é¡¹ã€‚é£é™©æ„è¯†ç¨³å®šã€‚</p>
                        </div>
                    `;
                }

                const avgStrat = Math.round(results.reduce((a,b)=>a+b.detail.strategy,0) / results.length);
                const avgRisk = Math.round(results.reduce((a,b)=>a+b.detail.risk,0) / results.length);
                const avgExp = Math.round(results.reduce((a,b)=>a+b.detail.explanation,0) / results.length);

                const getLabel = (score) => {
                    if(score > 25) return { text: "å¼º", class: "green" };
                    if(score > 18) return { text: "ä¸­", class: "" };
                    return { text: "å¼±", class: "red" };
                };

                const capHtml = `
                    <div class="summary-module">
                        <div class="module-title">ğŸ§© èƒ½åŠ›ç»“æ„</div>
                        <div class="cap-item"><span>ç­–ç•¥åˆ¤æ–­åŠ›:</span> <span class="stat-value ${getLabel(avgStrat).class}">${getLabel(avgStrat).text} (${avgStrat}/30)</span></div>
                        <div class="cap-item"><span>é£é™©æ§åˆ¶åŠ›:</span> <span class="stat-value ${getLabel(avgRisk).class}">${getLabel(avgRisk).text} (${avgRisk}/25)</span></div>
                        <div class="cap-item"><span>é€»è¾‘è¡¨è¾¾åŠ›:</span> <span class="stat-value ${getLabel(avgExp).class}">${getLabel(avgExp).text} (${avgExp}/30)</span></div>
                    </div>
                `;

                let authHtml = "";
                
                if (this.mode === 'training') {
                    authHtml = `
                        <div class="authority-block">
                            <div style="opacity:0.8; text-transform:uppercase; font-size:0.9rem;">è®­ç»ƒç»“æœ</div>
                            <div class="authority-status">ç»ƒä¹ å®Œæˆ</div>
                            <div class="authority-sub">
                                å»ºè®®å…³æ³¨é‡ç‚¹ï¼š${avgRisk < 20 ? "æ¡æ¬¾ä¸æ˜ç¡®æƒ…å†µä¸‹çš„é£é™©æ§åˆ¶ã€‚" : "æˆ˜ç•¥æ€§çš„æƒè¡¡å–èˆã€‚"}
                            </div>
                        </div>
                    `;
                } else {
                    let status = "";
                    let color = "";
                    let msg = "";
                    let scopeText = "";

                    if (blockCount > 0 || min < 60) {
                        status = "âŒ ä¸å…·å¤‡æŠ¥ä»·èµ„æ ¼";
                        color = "#ef4444";
                        msg = "å› é£é™©æš´éœ²é—®é¢˜ï¼Œä¸å…è®¸è¿›è¡Œç‹¬ç«‹æŠ¥ä»·ã€‚";
                        scopeText = "é€‚ç”¨èŒƒå›´ï¼šä»…é™ä¸»ç®¡å®¡æ‰¹åæŠ¥ä»·";
                    } else if (avg >= 80) {
                        status = "âœ… æˆæƒé€šè¿‡";
                        color = "#10b981";
                        msg = "å…·å¤‡åœ¨å½“å‰æˆæƒèŒƒå›´å†…å¤„ç†æŠ¥ä»·ä¸šåŠ¡çš„èµ„æ ¼ã€‚";
                        scopeText = "é€‚ç”¨èŒƒå›´ï¼šå¸¸è§„é¡¹ç›® / éæ”¿åºœé¡¹ç›® / éé«˜é£é™©ä»˜æ¬¾æ¡ä»¶";
                    } else {
                        status = "âš ï¸ éœ€å¤æ ¸";
                        color = "#f59e0b";
                        msg = "éœ€åœ¨ä¸»ç®¡å¤æ ¸åæ–¹å¯è¿›è¡Œç‹¬ç«‹æŠ¥ä»·ã€‚";
                        scopeText = "é€‚ç”¨èŒƒå›´ï¼šä»…é™ä¸»ç®¡å®¡æ‰¹åæŠ¥ä»·";
                    }

                    const consistencyNote = "<p class='policy-note'>ğŸ“Œ åˆ¶åº¦è¯´æ˜ï¼šéœ€è¿ç»­ 2 æ¬¡ Assessment é€šè¿‡ï¼Œæ–¹å¯æˆäºˆé•¿æœŸæŠ¥ä»·æƒé™ã€‚</p>";

                    authHtml = `
                        <div class="authority-block" style="background-color: ${color};">
                            <div style="opacity:0.9; text-transform:uppercase; font-size:0.9rem;">æŠ¥ä»·æˆæƒç»“è®º</div>
                            <div class="authority-status">${status}</div>
                            <div class="authority-sub">
                                ${msg}<br>
                                <div class="authority-scope">${scopeText}</div>
                                ${consistencyNote}
                            </div>
                        </div>
                    `;
                }

                const finalHtml = `
                    <div class="summary-grid">
                        ${statsHtml}
                        ${riskWarningHtml}
                        ${capHtml}
                    </div>
                    ${authHtml}
                `;

                document.getElementById('summary-content').innerHTML = finalHtml;

                this.elements.gameHeader.style.display = 'none';
                this.elements.gameMain.style.display = 'none';
                this.elements.gameFooter.style.display = 'none';
                this.elements.summaryScreen.style.display = 'block';
                window.scrollTo(0,0);
            }
        };

        document.getElementById('user-explanation').addEventListener('input', () => { game.checkSubmitState(); });

    </script>
</body>
</html>
```
