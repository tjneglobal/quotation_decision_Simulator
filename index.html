<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¥ä»·å†³ç­–å®éªŒå®¤ V5.3 (CN) - Enterprise Edition</title>
    <style>
        /* --- Base Styles (V5.3 CN) --- */
        :root {
            --primary-color: #0f172a;
            --accent-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-color: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #334155;
            --text-light: #64748b;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'PingFang SC', 'Microsoft YaHei', 'Segoe UI', Roboto, sans-serif; }
        body { background-color: var(--bg-color); color: var(--text-main); line-height: 1.6; min-height: 100vh; display: flex; flex-direction: column; }

        /* --- Layout --- */
        header { background-color: var(--primary-color); color: white; padding: 0.8rem 2rem; display: none; justify-content: space-between; align-items: center; box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; }
        
        .brand h1 { font-size: 1.25rem; font-weight: 600; }
        .brand span { color: var(--accent-color); font-size: 0.8rem; display: block; font-weight: 400; }
        
        /* Header Right Layout */
        .header-controls { display: flex; align-items: center; gap: 2rem; }
        
        .game-status { display: flex; gap: 1.5rem; align-items: center; }
        .mode-display { font-size: 0.8rem; text-transform: uppercase; font-weight: bold; letter-spacing: 1px; background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 4px; }
        .level-badge { background: var(--accent-color); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: bold; }
        .level-badge.l1 { background: #10b981; }
        .level-badge.l2 { background: #f59e0b; color: #000; }
        .level-badge.l3 { background: #ef4444; }

        .status-item strong { color: var(--accent-color); font-size: 1.1rem; }
        
        /* Exit Button Style */
        .btn-exit { 
            background: transparent; 
            border: 1px solid rgba(255,255,255,0.3); 
            color: white; 
            padding: 0.4rem 1rem; 
            border-radius: 6px; 
            font-size: 0.85rem; 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem;
        }
        .btn-exit:hover { background: rgba(239, 68, 68, 0.2); border-color: var(--danger-color); color: #fecaca; }

        main { flex: 1; padding: 2rem; max-width: 1200px; margin: 0 auto; width: 100%; display: none; grid-template-columns: 1fr 1fr; gap: 2rem; }
        @media (max-width: 900px) { main { grid-template-columns: 1fr; } }

        /* --- Cards --- */
        .card { background: var(--card-bg); border-radius: var(--border-radius); padding: 2rem; box-shadow: var(--shadow); display: flex; flex-direction: column; gap: 1.5rem; }
        .card-header { border-bottom: 1px solid #e2e8f0; padding-bottom: 1rem; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 1.1rem; font-weight: 600; color: var(--primary-color); display: flex; align-items: center; gap: 0.5rem; }

        /* --- Inquiry Visuals --- */
        .inquiry-paper { background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 4px; padding: 1.5rem; font-family: 'Courier New', Courier, monospace; font-size: 0.9rem; position: relative; }
        .inquiry-paper::before { content: "è¯¢ä»·å•"; position: absolute; top: -10px; right: 20px; background: var(--text-light); color: white; padding: 2px 8px; font-size: 0.7rem; font-weight: bold; border-radius: 2px; }
        .inquiry-tag {
            display: inline-block; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-bottom: 0.5rem; font-weight: bold;
        }
        .inquiry-tag.fwd { background: #e0e7ff; color: #3730a3; }
        .inquiry-tag.fish { background: #ecfccb; color: #3f6212; }
        .inquiry-tag.bench { background: #f3e8ff; color: #6b21a8; }
        .inquiry-tag.risk { background: #fee2e2; color: #991b1b; }

        .data-row { display: flex; margin-bottom: 0.8rem; border-bottom: 1px dashed #e2e8f0; padding-bottom: 0.4rem; }
        .data-label { width: 140px; font-weight: bold; color: var(--text-light); flex-shrink: 0; }
        .data-value { flex: 1; color: var(--primary-color); }
        .highlight-bad { color: var(--danger-color); font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* --- Interaction --- */
        .strategy-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        .strategy-btn { background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 1rem; cursor: pointer; transition: all 0.2s; text-align: center; position: relative; height: 100%; display: flex; flex-direction: column; justify-content: center;}
        .strategy-btn:hover { border-color: var(--accent-color); transform: translateY(-2px); }
        .strategy-btn.selected { background-color: #eff6ff; border-color: var(--accent-color); box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); }
        .strategy-btn h4 { margin-bottom: 0.5rem; font-size: 0.95rem; color: var(--primary-color); }
        .strategy-btn p { font-size: 0.75rem; color: var(--text-light); line-height: 1.3; }

        .checkbox-group { display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem; }
        .checkbox-label { display: flex; align-items: flex-start; gap: 0.5rem; font-size: 0.85rem; cursor: pointer; padding: 0.5rem; border-radius: 6px; transition: background 0.2s; border: 1px solid transparent; }
        .checkbox-label:hover { background: #f8fafc; border-color: #e2e8f0; }
        .checkbox-label input[type="checkbox"] { width: 16px; height: 16px; accent-color: var(--accent-color); margin-top: 3px; flex-shrink: 0;}

        textarea { width: 100%; padding: 1rem; border: 1px solid #cbd5e1; border-radius: 8px; resize: vertical; min-height: 120px; font-size: 0.95rem; transition: border 0.2s; }
        textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }

        .action-area { margin-top: auto; }
        .btn-primary { width: 100%; padding: 1rem; background: var(--accent-color); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .btn-primary:hover { background: #2563eb; }
        .btn-primary:disabled { background: #94a3b8; cursor: not-allowed; }

        .policy-note { font-size: 0.8rem; color: var(--text-light); margin-top: 0.8rem; padding-top: 0.8rem; border-top: 1px dashed #e2e8f0; font-style: italic; }

        /* --- Modal & Feedback --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; z-index: 1000; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { background: white; width: 90%; max-width: 600px; border-radius: var(--border-radius); padding: 2rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); transform: scale(0.9); transition: transform 0.3s; max-height: 90vh; overflow-y: auto; }
        .modal-overlay.active .modal-content { transform: scale(1); }

        .score-circle { width: 100px; height: 100px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 0 auto 1.5rem auto; border: 4px solid #e2e8f0; flex-shrink: 0; }
        .score-number { font-size: 2.5rem; font-weight: 700; line-height: 1; }
        .score-total { font-size: 0.8rem; opacity: 0.8; }

        .feedback-section { margin-bottom: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px; border-left: 4px solid var(--text-light); }
        .feedback-section.success { border-left-color: var(--success-color); }
        .feedback-section.warning { border-left-color: var(--warning-color); }
        .feedback-section.error { border-left-color: var(--danger-color); }
        .feedback-section.outcome { background: #eff6ff; border-left: 4px solid var(--accent-color); font-weight: 500; }
        .feedback-section.block { background: #fef2f2; border: 2px solid var(--danger-color); color: #7f1d1d; }
        .feedback-section.authority { background: #1e293b; color: white; text-align: center; border: 2px solid #334155; margin-bottom: 1.5rem; }

        .feedback-title { font-weight: 700; margin-bottom: 0.5rem; display: block; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 0.05em; }

        .score-breakdown { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; }
        .breakdown-item { display: flex; justify-content: space-between; font-size: 0.9rem; }

        .next-btn { background: var(--primary-color); color: white; padding: 0.8rem 2rem; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; display: block; margin: 0 auto; }
        .btn-restart { background: white; border: 1px solid var(--text-light); color: var(--text-main); margin-top: 10px;}

        /* --- Intro & Mode Selection --- */
        #intro-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 500; display: flex; justify-content: center; align-items: center; padding: 2rem; overflow-y: auto;}
        
        .intro-wrapper { width: 100%; max-width: 900px; display: flex; flex-direction: column; gap: 2rem; align-items: center; }
        
        .intro-card { background: white; padding: 2.5rem; border-radius: var(--border-radius); box-shadow: var(--shadow); width: 100%; display: flex; flex-direction: column; gap: 1.5rem; }
        
        .level-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; text-align: center; }
        .level-box { padding: 1rem; border-radius: 8px; font-size: 0.9rem; text-align: left; border: 1px solid #e2e8f0; }
        .level-box h4 { margin-bottom: 0.5rem; font-size: 1rem; }
        .lvl-1 { background: #d1fae5; color: #065f46; }
        .lvl-2 { background: #fef3c7; color: #92400e; }
        .lvl-3 { background: #fee2e2; color: #991b1b; }

        .action-buttons-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .btn-mode {
            padding: 1.5rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        .btn-mode:active { transform: scale(0.98); }
        .btn-mode.training { background: linear-gradient(135deg, var(--accent-color) 0%, #2563eb 100%); color: white; }
        .btn-mode.training:hover { box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.4); transform: translateY(-2px); }
        .btn-mode.assessment { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white; border: 1px solid #334155; }
        .btn-mode.assessment:hover { box-shadow: 0 10px 15px -3px rgba(15, 23, 42, 0.4); transform: translateY(-2px); }
        .btn-mode h3 { font-size: 1.2rem; margin: 0; }
        .btn-mode p { font-size: 0.85rem; opacity: 0.9; margin: 0; }

        .btn-manual {
            margin: 1rem auto 0;
            background: transparent;
            border: 1px dashed var(--accent-color);
            color: var(--accent-color);
            padding: 0.6rem 2rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        .btn-manual:hover { background: #eff6ff; }

        /* --- Manual / Instruction Page Styles --- */
        .manual-container { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 600; 
            padding: 2rem; display: none; opacity: 0; transition: opacity 0.3s ease;
            overflow-y: auto; box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
        .manual-container.active { display: block; opacity: 1; }
        .manual-content-wrapper { max-width: 900px; margin: 0 auto; }
        .manual-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; background: white; z-index: 10; }
        .manual-back { background: transparent; border: 1px solid #cbd5e1; color: var(--text-main); padding: 0.5rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s; font-size: 0.9rem; }
        .manual-back:hover { background: #f1f5f9; border-color: var(--accent-color); }
        .instruction-section { margin-bottom: 2.5rem; padding-bottom: 2.5rem; border-bottom: 1px dashed #e2e8f0; }
        .instruction-section:last-child { border-bottom: none; }
        .instruction-section h2 { font-size: 1.4rem; color: var(--primary-color); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .instruction-section h3 { font-size: 1.1rem; color: var(--primary-color); margin-bottom: 0.8rem; margin-top: 1.5rem; border-left: 4px solid var(--accent-color); padding-left: 0.8rem; }
        .instruction-section ul { margin: 0.5rem 0 0 1.5rem; font-size: 0.95rem; color: var(--text-main); list-style-type: circle; }
        .instruction-section ul li { margin-bottom: 0.6rem; line-height: 1.6; }
        .instruction-section p { margin-bottom: 0.8rem; color: var(--text-main); font-size: 0.95rem; line-height: 1.6; }
        .score-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9rem; background: white; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
        .score-table th, .score-table td { border: 1px solid #e2e8f0; padding: 0.8rem; text-align: left; }
        .score-table th { background: #f8fafc; font-weight: 600; }
        .note { background: #fff7ed; border-left: 4px solid var(--warning-color); padding: 1rem 1.2rem; margin-top: 1rem; font-size: 0.9rem; color: #9a3412; border-radius: 4px; }

        /* --- Session Summary Screen Styles --- */
        #summary-screen { display: none; padding: 2rem; max-width: 1000px; margin: 2rem auto; }
        .summary-container { background: white; border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 3rem; }
        .summary-header { text-align: center; border-bottom: 2px solid #e2e8f0; padding-bottom: 2rem; margin-bottom: 2rem; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem; }
        .summary-module { background: #f8fafc; padding: 1.5rem; border-radius: 8px; border: 1px solid #e2e8f0; }
        .module-title { font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-light); margin-bottom: 1rem; font-weight: 700; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 1rem; }
        .stat-value { font-weight: 600; }
        .stat-value.red { color: var(--danger-color); }
        .stat-value.green { color: var(--success-color); }
        .authority-block { background: var(--primary-color); color: white; padding: 2rem; border-radius: 12px; text-align: center; margin-top: 2rem; }
        .authority-status { font-size: 2rem; font-weight: 800; margin: 1rem 0; }
        .authority-sub { font-size: 1rem; opacity: 0.9; }
        .authority-scope { margin-top: 1rem; font-size: 0.9rem; background: rgba(255,255,255,0.1); padding: 0.5rem 1rem; display: inline-block; border-radius: 4px; }
        .cap-item { display: flex; justify-content: space-between; padding: 0.8rem 0; border-bottom: 1px dashed #e2e8f0; }
        footer { text-align: center; padding: 1rem; color: var(--text-light); font-size: 0.8rem; }

        /* --- Detail Report Styles (V5.3 New) --- */
        #detail-report-view { display: none; padding: 3rem; max-width: 900px; margin: 0 auto; background: white; min-height: 100vh; }
        .report-header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 2rem; margin-bottom: 3rem; }
        .report-section { margin-bottom: 3rem; page-break-inside: avoid; }
        .report-item { border: 1px solid #e2e8f0; border-left: 4px solid var(--primary-color); padding: 1.5rem; margin-bottom: 1.5rem; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .report-meta { display: flex; justify-content: space-between; margin-bottom: 1rem; border-bottom: 1px dashed #e2e8f0; padding-bottom: 0.5rem; font-size: 0.85rem; color: var(--text-light); }
        .report-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1rem; }
        .report-label { font-weight: bold; color: var(--text-main); font-size: 0.9rem; }
        .report-val { font-size: 0.9rem; color: var(--text-main); }
        .report-explanation { background: #f8fafc; padding: 1rem; border-radius: 4px; font-style: italic; font-family: serif; border-left: 3px solid #cbd5e1; margin-top: 1rem; }
        .report-actions { margin-top: 3rem; text-align: center; border-top: 2px solid #e2e8f0; padding-top: 2rem; }
        .btn-print { background: var(--primary-color); color: white; border: none; padding: 0.8rem 2rem; border-radius: 6px; cursor: pointer; font-size: 1rem; display: inline-flex; align-items: center; gap: 0.5rem; }
        
        @media print {
            body { background: white; -webkit-print-color-adjust: exact; }
            #intro-screen, header, #summary-screen, #detail-report-view button { display: none !important; }
            #detail-report-view { display: block !important; padding: 0; margin: 0; }
            .report-item { break-inside: avoid; box-shadow: none; border: 1px solid #ccc; }
        }
    </style>
</head>
<body>

    <!-- Intro Screen -->
    <div id="intro-screen">
        <div class="manual-container" id="manual-view">
            <div class="manual-content-wrapper">
                <div class="manual-nav">
                    <button class="manual-back" onclick="game.backToMenu()">â¬… è¿”å›ä¸»èœå•</button>
                    <h2 style="margin: 0;">ç³»ç»Ÿè¯´æ˜ä¹¦ V5.3</h2>
                </div>
                
                <div class="instruction-section">
                    <h2>ä¸€ã€è¯„åˆ†æ ‡å‡†è¯´æ˜</h2>
                    <table class="score-table">
                        <tr><th>ç»´åº¦</th><th>åˆ†å€¼</th><th>è¯„åˆ¤è¦ç‚¹</th></tr>
                        <tr><td>å› æœé€»è¾‘</td><td>10</td><td>æ˜¯å¦æ˜ç¡®è¯´æ˜â€œå› ä¸º â†’ æ‰€ä»¥â€</td></tr>
                        <tr><td>é£é™©è¯†åˆ«</td><td>8</td><td>æ˜¯å¦ç‚¹å‡ºä»˜æ¬¾ / æŠ€æœ¯ / äº¤æœŸé£é™©</td></tr>
                        <tr><td>æƒè¡¡æ„è¯†</td><td>6</td><td>æ˜¯å¦ä½“ç°å–èˆï¼Œè€Œéâ€œéƒ½æƒ³è¦â€</td></tr>
                        <tr><td>å•†ä¸šè¯­è¨€</td><td>6</td><td>æ˜¯å¦å¯ç›´æ¥ç”¨äºå¯¹å¤–æŠ¥ä»·è¯´æ˜</td></tr>
                    </table>
                    <div class="note">æ³¨ï¼šæœ¬é¡¹ä¸è€ƒå¯Ÿæ–‡é‡‡ï¼Œè€ƒå¯Ÿâ€œæ˜¯å¦å…·å¤‡å‘ä¸»ç®¡è§£é‡ŠæŠ¥ä»·é€»è¾‘çš„èƒ½åŠ›â€ã€‚</div>
                </div>

                <div class="instruction-section">
                    <h2>äºŒã€è¯¢ä»·ç±»å‹ä¸å¸¸è§é”™è¯¯</h2>
                    <h3>1. è½¬å‘å‹è¯¢ä»·</h3>
                    <p><strong>å¸¸è§é”™è¯¯ï¼š</strong>é»˜è®¤å¯¹æ–¹å°±æ˜¯ç»ˆç«¯å®¢æˆ·ï¼›æœªç¡®è®¤ä»˜æ¬¾è´£ä»»äººã€‚</p>
                    <p><strong>åŸ¹è®­é‡ç‚¹ï¼š</strong>ä¸æ¸…æ¥šè°ä»˜é’±ï¼Œå°±ä¸æ¸…æ¥šä½ åœ¨ä¸ºè°æ‰¿æ‹…é£é™©ã€‚</p>
                    
                    <h3>2. æŠ€æœ¯è¯•æ¢å‹</h3>
                    <p><strong>å¸¸è§é”™è¯¯ï¼š</strong>èŠ±å¤§é‡æ—¶é—´å®šåˆ¶æ–¹æ¡ˆï¼›æŠ¥å‡ºæ¥è¿‘æˆæœ¬çš„ä»·æ ¼ã€‚</p>
                    <p><strong>åŸ¹è®­é‡ç‚¹ï¼š</strong>æŠ€æœ¯è¯•æ¢ â‰  å•†ä¸šæœºä¼šã€‚</p>

                    <h3>3. æ¯”ä»·å‹</h3>
                    <p><strong>å¸¸è§é”™è¯¯ï¼š</strong>ä¸ºâ€œæ‹¿ä¸‹ç¬¬ä¸€å•â€æ— åº•çº¿é™ä»·ã€‚</p>
                    <p><strong>åŸ¹è®­é‡ç‚¹ï¼š</strong>å¦‚æœä½ åªæ˜¯ä»·æ ¼é”šç‚¹ï¼Œä½ æ°¸è¿œä¸ä¼šæ˜¯ä¾›åº”å•†ã€‚</p>

                    <h3>4. é£é™©è½¬ç§»å‹</h3>
                    <p><strong>å¸¸è§é”™è¯¯ï¼š</strong>æ¥å—â€œç­‰é¡¹ç›®å›æ¬¾å†ä»˜â€ï¼›æ²¡æœ‰æŠŠé£é™©å†™è¿›ä»·æ ¼ã€‚</p>
                    <p><strong>åŸ¹è®­é‡ç‚¹ï¼š</strong>ä¸è®¡å…¥ä»·æ ¼çš„é£é™©ï¼Œä¸€å®šä¼šå˜æˆæŸå¤±ã€‚</p>
                </div>
            </div>
        </div>

        <div class="intro-wrapper">
            <div class="intro-card" id="menu-view">
                <div style="text-align:center; margin-bottom:1rem;">
                    <h1 style="color: var(--primary-color); margin-bottom: 0.5rem; font-size: 2rem;">å•†ä¸šæŠ¥ä»·å†³ç­–å®éªŒå®¤</h1>
                    <p style="color: var(--text-light); font-size: 1.1rem;">æŠ¥ä»·èƒ½åŠ›è¯„ä¼°ä¸é£é™©æ§åˆ¶ç³»ç»Ÿ V5.3</p>
                </div>

                <div class="action-buttons-group">
                    <button class="btn-mode training" onclick="game.start('training')">
                        <span style="font-size: 2rem;">ğŸ“</span>
                        <h3>å¼€å§‹è®­ç»ƒæ¨¡å¼</h3>
                        <p>æ˜¾ç¤ºå®æ—¶é£é™©æç¤º<br>åŒ…å«è¯¦ç»†è¯„åˆ†è§£æ</p>
                    </button>
                    <button class="btn-mode assessment" onclick="game.start('assessment')">
                        <span style="font-size: 2rem;">ğŸ“</span>
                        <h3>å¼€å§‹è¯„ä¼°æ¨¡å¼</h3>
                        <p>æ— è¿‡ç¨‹æç¤º<br>åŒ…å«é«˜é£é™©å¿…è€ƒé¢˜</p>
                    </button>
                </div>

                <button class="btn-manual" onclick="game.showManual()">ğŸ“– æŸ¥çœ‹ç³»ç»Ÿè¯´æ˜ä¹¦</button>
            </div>
        </div>
    </div>

    <!-- Main Game Interface -->
    <header id="game-header" class="game-header">
        <div class="brand">
            <h1>æŠ¥ä»·å†³ç­–å®éªŒå®¤</h1>
            <span id="header-mode-text">è®­ç»ƒæ¨¡å¼</span>
        </div>
        <div class="header-controls">
            <button class="btn-exit" onclick="game.exit()"><span>âœ•</span> é€€å‡ºè¯„ä¼°</button>
            <div class="game-status">
                <div class="mode-display" id="mode-display">TRAINING</div>
                <div class="level-badge l1" id="level-badge">L1</div>
                <div class="status-item">åœºæ™¯: <strong id="round-display">1/3</strong></div>
            </div>
        </div>
    </header>

    <main id="game-main" class="game-main">
        <section class="card">
            <div class="card-header">
                <div class="card-title">ğŸ“„ å®¢æˆ·è¯¢ä»·å•</div>
                <div style="font-size:0.8rem; color:var(--text-light)" id="scenario-id">L1-01</div>
            </div>
            <div id="inquiry-container"></div>
            <div id="mentor-container" style="margin-top: 1rem; padding: 1rem; background: #fff7ed; border-left: 4px solid #f97316; font-size: 0.85rem; color: #9a3412;">
                <strong>ğŸ’¡ é£é™©æç¤ºï¼š</strong> <span id="mentor-hint">Loading...</span>
            </div>
        </section>

        <section class="card">
            <div class="card-header"><div class="card-title">ğŸ¯ æŠ¥ä»·å†³ç­–</div></div>
            <div>
                <label style="font-weight: 600; font-size: 0.95rem; display: block; margin-bottom: 0.5rem;">Step 1ï¼šé€‰æ‹©æŠ¥ä»·ç­–ç•¥</label>
                <div class="strategy-options">
                    <div class="strategy-btn" onclick="game.selectStrategy('aggressive', this)">
                        <h4>æ¿€è¿›å‹ç­–ç•¥</h4>
                        <p>ä»¥æé«˜ä¸­æ ‡æ¦‚ç‡ä¸ºä¼˜å…ˆ<br>æ¥å—è¾ƒä½åˆ©æ¶¦ç©ºé—´</p>
                    </div>
                    <div class="strategy-btn" onclick="game.selectStrategy('balanced', this)">
                        <h4>å¹³è¡¡å‹ç­–ç•¥</h4>
                        <p>åœ¨åˆ©æ¶¦ã€é£é™©ä¸æˆäº¤æ¦‚ç‡<br>ä¹‹é—´ä¿æŒå¹³è¡¡</p>
                    </div>
                    <div class="strategy-btn" onclick="game.selectStrategy('conservative', this)">
                        <h4>ä¿å®ˆå‹ç­–ç•¥</h4>
                        <p>ä»¥é£é™©æ§åˆ¶ä¸åˆ©æ¶¦å®‰å…¨ä¸ºä¼˜å…ˆ<br>é™ä½ä¸­æ ‡æ¦‚ç‡</p>
                    </div>
                </div>
            </div>

            <div style="margin-top: 1.5rem;">
                <label style="font-weight: 600; font-size: 0.95rem; display: block; margin-bottom: 0.5rem;">Step 2ï¼šé£é™©æ§åˆ¶æ¡æ¬¾é€‰æ‹©ï¼ˆæ ‡å‡†è¯æœ¯ï¼‰</label>
                <div class="checkbox-group">
                    <label class="checkbox-label" onchange="game.updateMentorHint()">
                        <input type="checkbox" value="validity"> æœ¬æŠ¥ä»·ä»…åœ¨ã€X æ—¥ã€‘å†…æœ‰æ•ˆï¼Œé€¾æœŸéœ€é‡æ–°ç¡®è®¤ä»·æ ¼åŠäº¤æœŸ
                    </label>
                    <label class="checkbox-label" onchange="game.updateMentorHint()">
                        <input type="checkbox" value="payment_spec"> æœ¬æŠ¥ä»·åŸºäºã€ä»˜æ¬¾æ–¹å¼/è´¦æœŸã€‘å‰æï¼Œè‹¥ä»˜æ¬¾æ¡ä»¶è°ƒæ•´ï¼Œä»·æ ¼ä¸äº¤æœŸéœ€åŒæ­¥è°ƒæ•´
                    </label>
                    <label class="checkbox-label" onchange="game.updateMentorHint()">
                        <input type="checkbox" value="tech_clarify"> æœ¬æŠ¥ä»·åŸºäºå½“å‰æŠ€æœ¯å‚æ•°ï¼Œæœ€ç»ˆä»·æ ¼ä»¥æŠ€æœ¯ç¡®è®¤/å›¾çº¸å†»ç»“ä¸ºå‡†
                    </label>
                    <label class="checkbox-label" onchange="game.updateMentorHint()">
                        <input type="checkbox" value="delivery_cond"> äº¤æœŸè‡ªæŠ€æœ¯ç¡®è®¤åŠé¢„ä»˜æ¬¾åˆ°è´¦åå¼€å§‹è®¡ç®—
                    </label>
                </div>
                <div class="policy-note">è¯´æ˜ï¼šç³»ç»Ÿå°†æ ¹æ®å®¢æˆ·ä¿¡æ¯å®Œæ•´æ€§ä¸é£é™©ç­‰çº§ï¼Œè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦å­˜åœ¨â€œå¿…é¡»è¡¥å……çš„é£é™©æ§åˆ¶æ¡æ¬¾â€ã€‚</div>
            </div>

            <div style="margin-top: 1.5rem; flex: 1;">
                <label style="font-weight: 600; font-size: 0.95rem; display: block; margin-bottom: 0.5rem;">Step 3ï¼šæŠ¥ä»·å†³ç­–è¯´æ˜ï¼ˆéœ€ä½“ç°å› æœé€»è¾‘ï¼‰</label>
                <textarea id="user-explanation" placeholder="è¯·è¯´æ˜ï¼š&#10;â€¢ é€‰æ‹©è¯¥æŠ¥ä»·ç­–ç•¥çš„ä¸»è¦åŸå› &#10;â€¢ é£é™©ç‚¹è¯†åˆ«åŠåº”å¯¹æ–¹å¼&#10;â€¢ ä»·æ ¼ã€é£é™©ä¸æˆäº¤æ¦‚ç‡ä¹‹é—´çš„åˆ¤æ–­é€»è¾‘"></textarea>
            </div>

            <div class="action-area">
                <button id="submit-btn" class="btn-primary" onclick="game.submitQuote()" disabled>æäº¤æŠ¥ä»·å†³ç­–</button>
            </div>
        </section>
    </main>

    <!-- Summary Screen -->
    <div id="summary-screen" class="summary-screen">
        <div class="summary-container">
            <div class="summary-header">
                <h1 style="color: var(--primary-color);">è¯„ä¼°ç»“æœæŠ¥å‘Š</h1>
                <p style="color: var(--text-light); margin-top: 0.5rem;">æŠ¥ä»·å†³ç­–èƒ½åŠ›ä¸é£é™©æ§åˆ¶ç»¼åˆåˆ†æ</p>
            </div>
            <div id="summary-content"></div>
            <div style="text-align:center; margin-top: 2rem;">
                 <button class="next-btn" style="background: var(--text-light)" onclick="game.showDetailReport()">ğŸ“„ æŸ¥çœ‹è¯¦ç»†è¿‡ç¨‹è®°å½•</button>
                 <div style="height: 10px;"></div>
                 <button class="next-btn btn-restart" onclick="game.exit()">è¿”å›ä¸»èœå•</button>
            </div>
        </div>
    </div>

    <!-- Detail Report View (V5.3 New) -->
    <div id="detail-report-view">
        <div class="report-header">
            <h1>æŠ¥ä»·å†³ç­–è¿‡ç¨‹è®°å½•æŠ¥å‘Š</h1>
            <p>ç”Ÿæˆæ—¥æœŸ: <span id="report-date"></span> | æ¨¡å¼: <span id="report-mode"></span></p>
        </div>
        <div id="report-content"></div>
        <div class="report-actions">
            <button class="btn-print" onclick="window.print()">ğŸ–¨ æ‰“å° / ä¿å­˜ä¸º PDF</button>
            <button class="manual-back" onclick="game.backToSummary()">è¿”å›æ±‡æ€»é¡µ</button>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal-overlay" id="feedback-modal">
        <div class="modal-content">
            <div class="score-circle">
                <div class="score-number" id="modal-score">0</div>
                <div class="score-total">/ 100</div>
            </div>
            <h3 style="text-align: center; margin-bottom: 1.5rem; font-weight: 600;">è¯„ä¼°åé¦ˆ</h3>
            <div id="assessment-disclaimer" style="display:none; font-size: 0.8rem; color: var(--text-light); margin-bottom: 1rem; text-align: center; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem;">
                è¯´æ˜ï¼šè¯„ä¼°æ¨¡å¼ä¸‹ä¸å±•ç¤ºè¿‡ç¨‹æ€§è¯„åˆ†ï¼Œä»…å±•ç¤ºæœ€ç»ˆç»“è®ºã€‚
            </div>
            <div id="feedback-container"></div>
            <div class="score-breakdown" id="detail-scores" style="margin-top: 1.5rem; border-top: 1px solid #e2e8f0; padding-top: 1rem;">
                <div class="breakdown-item"><span>ç­–ç•¥è¯„åˆ†:</span> <strong id="score-strategy">0/30</strong></div>
                <div class="breakdown-item"><span>é£æ§è¯„åˆ†:</span> <strong id="score-risk">0/25</strong></div>
                <div class="breakdown-item"><span>æ¡æ¬¾è¯„åˆ†:</span> <strong id="score-conditions">0/15</strong></div>
                <div class="breakdown-item"><span>é€»è¾‘è¯„åˆ†:</span> <strong id="score-explanation">0/30</strong></div>
            </div>
            <div style="margin-top: 2rem;">
                <button class="next-btn" id="next-round-btn" onclick="game.nextRound()">ä¸‹ä¸€é¢˜</button>
                <button class="next-btn btn-restart" id="finish-btn" onclick="game.finish()" style="display: none;">æŸ¥çœ‹æœ€ç»ˆæŠ¥å‘Š</button>
            </div>
        </div>
    </div>

    <footer id="game-footer"><p>Â© 2025 è¥¿å®‰æ³°é‡‘æ–°èƒ½ç§‘æŠ€æœ‰é™å…¬å¸ - å†…éƒ¨æŠ¥ä»·èƒ½åŠ›è¯„ä¼°ç³»ç»Ÿ</p></footer>

    <script>
        /* ================= SCENARIOS DATA (V5.3 Expanded) ================= */
        const baseScenarios = [
            { id: "L1-01", level: 1, inquiryType: "standard", customer: "European EPC Contractor", application: "Oil & Gas Pipeline CP", product: "MMO Tubular Anodes", quantity: "120 pcs", delivery: "8â€“10 weeks", payment: "Not specified", targetPrice: "Comparing suppliers", additionalInfo: "Project-based EPC, limited technical details", hint: "æœªæŒ‡å®šä»˜æ¬¾æ¡æ¬¾æ˜¯ä¸»è¦æ½œåœ¨é£é™©ã€‚", logic: { riskLevel: "high", optimalStrategy: "balanced", requiredConditions: ["payment_spec"], bonusConditions: ["tech_clarify"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L1-02", level: 1, inquiryType: "standard", customer: "Eastern Europe CP Service", application: "Pipeline Maintenance", product: "MMO Ribbon Anodes", quantity: "2,000 m", delivery: "6â€“8 weeks", payment: "T/T 30% advance, 70% before shipment", targetPrice: "Price sensitive", additionalInfo: "Repeat purchasing history", hint: "é•¿æœŸåˆä½œå¹¶ä¸ä»£è¡¨å¯ä»¥æ”¾å¼ƒåˆ©æ¶¦ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: [], bonusConditions: ["validity"], forbiddenConditions: [], competitorPressure: true } },
            { id: "L3-26", level: 3, inquiryType: "standard", customer: "Asian Copper Foil Maker", application: "High-Speed Foil Line", product: "DSA Anodes", quantity: "Full production line", delivery: "Project based", payment: "Milestone", targetPrice: "Benchmarking global", additionalInfo: "Failure impacts entire line", hint: "è¿™é‡Œä¸€ä¸ªé”™è¯¯å°±ä¼šé€ æˆæ•°ç™¾ä¸‡æŸå¤±ã€‚", logic: { riskLevel: "critical", optimalStrategy: "conservative", requiredConditions: ["tech_clarify", "payment_spec", "delivery_cond"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            // ... (Keep other base scenarios as needed, integrating inquiryType: "standard" for old ones) ...
             { id: "L3-30", level: 3, inquiryType: "standard", customer: "Unknown Trading Co", application: "CP/Water (Unclear)", product: "MMO Anodes", quantity: "Unclear", delivery: "Urgent", payment: "Not mentioned", targetPrice: "Extremely low", additionalInfo: "Refuses details", hint: "ä¸æ˜¯æ‰€æœ‰è¯¢ä»·éƒ½å€¼å¾—æŠ¥ä»·ã€‚", logic: { riskLevel: "critical", optimalStrategy: "conservative", requiredConditions: ["payment_spec", "tech_clarify"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } }
        ];

        // New Expanded Scenarios (V5.3) - Representative set of the 70 requested
        const extraScenarios = [
            /* --- forwarded (è½¬å‘å‹) --- */
            { id: "L4-31", level: 1, inquiryType: "forwarded", customer: "Asia Trading Company", application: "Pipeline CP", product: "MMO Tubular Anodes", quantity: "100 pcs", delivery: "Urgent", payment: "Not specified", targetPrice: "Best price required", additionalInfo: "Refuses to disclose end user", hint: "è´£ä»»ä¸»ä½“ä¸ä»˜æ¬¾æ–¹ä¸æ¸…ã€‚", logic: { riskLevel: "high", optimalStrategy: "balanced", requiredConditions: ["payment_spec", "tech_clarify"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            { id: "L4-32", level: 1, inquiryType: "forwarded", customer: "Middle East Agent", application: "Tank CP", product: "MMO Canister Anodes", quantity: "50 pcs", delivery: "8 weeks", payment: "As per end client", targetPrice: "Support tender", additionalInfo: "Used for bidding only", hint: "æŠ¥ä»·å¯èƒ½ä»…ä½œä¸ºæŠ•æ ‡å·¥å…·ã€‚", logic: { riskLevel: "high", optimalStrategy: "conservative", requiredConditions: ["payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },
            
            /* --- fishing (è¯•æ¢å‹) --- */
            { id: "L4-46", level: 2, inquiryType: "fishing", customer: "European Startup", application: "Advanced Water Process", product: "MMO Mesh Anodes", quantity: "5 pcs", delivery: "2 weeks", payment: "Sample price", targetPrice: "Reference only", additionalInfo: "Frequent technical questions", hint: "è¯•æ¢æ€§è¯¢ä»·ï¼Œå•†ä¸šæ„å›¾å¼±ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["validity"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            
            /* --- benchmark (æ¯”ä»·å‹) --- */
            { id: "L4-58", level: 2, inquiryType: "benchmark", customer: "European EPC", application: "Pipeline CP", product: "MMO Ribbon Anodes", quantity: "3000 m", delivery: "Standard", payment: "Net 45", targetPrice: "Below current supplier", additionalInfo: "Already has incumbent supplier", hint: "ä½ å¯èƒ½åªæ˜¯ä»·æ ¼é”šç‚¹ã€‚", logic: { riskLevel: "medium", optimalStrategy: "conservative", requiredConditions: ["validity"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },

            /* --- framework_trial (æ¡†æ¶å‰è¯•å•) --- */
            { id: "L4-66", level: 3, inquiryType: "framework_trial", customer: "European Water OEM", application: "Electro-chlorination", product: "MMO Anodes", quantity: "20 sets", delivery: "Rolling", payment: "Net 30", targetPrice: "Target cost", additionalInfo: "Claims future volume", hint: "è¯•å•ä»·æ ¼å¯èƒ½æˆä¸ºé•¿æœŸåŸºå‡†ã€‚", logic: { riskLevel: "medium", optimalStrategy: "balanced", requiredConditions: ["validity"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } },

            /* --- risk_shifting (é£é™©è½¬ç§»å‹) --- */
            { id: "L4-72", level: 3, inquiryType: "risk_shifting", customer: "LatAm EPC", application: "Wastewater Treatment", product: "MMO Anodes", quantity: "Project based", delivery: "Project schedule", payment: "After project payment", targetPrice: "Negotiable", additionalInfo: "Payment linked to owner cashflow", hint: "ä»˜æ¬¾é£é™©è¢«è½¬ç§»ç»™ä¾›åº”å•†ã€‚", logic: { riskLevel: "critical", optimalStrategy: "conservative", requiredConditions: ["payment_spec"], bonusConditions: [], forbiddenConditions: [], competitorPressure: false } },
            
            /* --- high_risk_attractive (é«˜è¯±æƒ‘é«˜é£é™©) --- */
            { id: "L4-96", level: 3, inquiryType: "high_risk_attractive", customer: "Fast Growing Overseas OEM", application: "CP + Water", product: "MMO Anodes", quantity: "30 pcs (trial)", delivery: "6 weeks", payment: "T/T after shipment", targetPrice: "Very aggressive", additionalInfo: "Promises future 10x volume", hint: "æœªæ¥æ‰¿è¯ºä¸èƒ½æŠµæ¶ˆå½“å‰é£é™©ã€‚", logic: { riskLevel: "high", optimalStrategy: "balanced", requiredConditions: ["payment_spec", "validity"], bonusConditions: [], forbiddenConditions: [], competitorPressure: true } }
        ];

        // Merge Arrays
        const scenarios = [...baseScenarios, ...extraScenarios];

        /* ================= MODIFIERS & LOGIC ================= */
        const inquiryTypeModifiers = {
            forwarded: {
                riskPenaltyMultiplier: 1.2,
                explanationBonusRequired: true
            },
            fishing: {
                strategyScoreCap: 25,
                explanationWeight: 1.2
            },
            benchmark: {
                aggressivePenalty: true
            },
            framework_trial: {
                validityRequired: true
            },
            risk_shifting: {
                paymentRequired: true,
            },
            high_risk_attractive: {
                disableBonus: true
            }
        };

        const game = {
            mode: 'training',
            currentRound: 0,
            sessionScenarios: [],
            sessionResults: [], 
            currentScenario: null,
            selectedStrategy: null,
            
            elements: {
                intro: document.getElementById('intro-screen'),
                menuView: document.getElementById('menu-view'),
                manualView: document.getElementById('manual-view'),
                gameHeader: document.getElementById('game-header'),
                gameMain: document.getElementById('game-main'),
                gameFooter: document.getElementById('game-footer'),
                summaryScreen: document.getElementById('summary-screen'),
                detailReportView: document.getElementById('detail-report-view'),
                roundDisplay: document.getElementById('round-display'),
                modeDisplay: document.getElementById('mode-display'),
                headerModeText: document.getElementById('header-mode-text'),
                levelBadge: document.getElementById('level-badge'),
                scenarioId: document.getElementById('scenario-id'),
                inquiryContainer: document.getElementById('inquiry-container'),
                mentorContainer: document.getElementById('mentor-container'),
                mentorHint: document.getElementById('mentor-hint'),
                strategyBtns: document.querySelectorAll('.strategy-btn'),
                submitBtn: document.getElementById('submit-btn'),
                explanation: document.getElementById('user-explanation'),
                modal: document.getElementById('feedback-modal'),
                assessmentDisclaimer: document.getElementById('assessment-disclaimer'),
                feedbackContainer: document.getElementById('feedback-container'),
                nextBtn: document.getElementById('next-round-btn'),
                finishBtn: document.getElementById('finish-btn'),
                detailScores: document.getElementById('detail-scores'),
                scoreDetails: { strategy: document.getElementById('score-strategy'), risk: document.getElementById('score-risk'), conditions: document.getElementById('score-conditions'), explanation: document.getElementById('score-explanation') }
            },

            showManual: function() { this.elements.manualView.classList.add('active'); },
            backToMenu: function() { this.elements.manualView.classList.remove('active'); },

            start: function(selectedMode) {
                this.mode = selectedMode;
                this.sessionResults = []; 
                this.elements.intro.style.display = 'none';
                this.elements.gameHeader.style.display = 'flex';
                this.elements.gameMain.style.display = 'grid';
                this.elements.gameFooter.style.display = 'block';
                this.elements.headerModeText.innerText = this.mode === 'training' ? 'è®­ç»ƒæ¨¡å¼' : 'è¯„ä¼°æ¨¡å¼';
                this.sessionScenarios = this.pickRandomScenarios();
                this.loadRound(0);
            },

            exit: function() {
                if(confirm("ç¡®å®šè¦é€€å‡ºå½“å‰è¯„ä¼°å—ï¼Ÿ\nå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚")) this.resetUI();
            },

            resetUI: function() {
                ['gameHeader','gameMain','gameFooter','summaryScreen','detailReportView'].forEach(id => this.elements[id.replace('Header','Header').replace('Main','Main').replace('Footer','Footer')].style.display = 'none');
                // Quick fix for mapping
                this.elements.gameHeader.style.display = 'none';
                this.elements.gameMain.style.display = 'none';
                this.elements.gameFooter.style.display = 'none';
                this.elements.summaryScreen.style.display = 'none';
                this.elements.detailReportView.style.display = 'none';
                this.elements.modal.classList.remove('active');
                this.elements.manualView.classList.remove('active');
                this.elements.intro.style.display = 'flex';
                this.currentRound = 0;
                this.sessionResults = [];
            },

            pickRandomScenarios: function() {
                // Mix old and new scenarios
                if (this.mode === 'assessment') {
                    // Prioritize high risk and specific types for assessment
                    const critical = scenarios.filter(s => s.logic.riskLevel === 'critical' || s.inquiryType === 'risk_shifting');
                    const pickCrit = critical[Math.floor(Math.random() * critical.length)];
                    const remaining = scenarios.filter(s => s.id !== pickCrit.id);
                    // Pick 2 random from remaining
                    const picks = remaining.sort(() => 0.5 - Math.random()).slice(0, 2);
                    return [pickCrit, ...picks].sort(() => 0.5 - Math.random());
                } else {
                    return scenarios.sort(() => 0.5 - Math.random()).slice(0, 3);
                }
            },

            loadRound: function(roundIndex) {
                this.currentRound = roundIndex;
                this.currentScenario = this.sessionScenarios[roundIndex];
                this.selectedStrategy = null;
                
                this.elements.roundDisplay.innerText = `${roundIndex + 1}/${this.sessionScenarios.length}`;
                this.elements.modeDisplay.innerText = this.mode === 'training' ? 'TRAINING' : 'ASSESSMENT';
                this.elements.scenarioId.innerText = this.currentScenario.id;
                
                const lvl = this.currentScenario.level;
                this.elements.levelBadge.innerText = `L${lvl}`;
                this.elements.levelBadge.className = `level-badge l${lvl}`;

                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                this.elements.explanation.value = "";
                this.elements.strategyBtns.forEach(btn => btn.classList.remove('selected'));
                this.elements.submitBtn.disabled = true;

                const s = this.currentScenario;
                // Inquiry Type Tag
                let typeTag = '';
                if (s.inquiryType === 'forwarded') typeTag = '<span class="inquiry-tag fwd">è½¬å‘å‹è¯¢ä»·</span>';
                if (s.inquiryType === 'fishing') typeTag = '<span class="inquiry-tag fish">æŠ€æœ¯è¯•æ¢å‹</span>';
                if (s.inquiryType === 'benchmark') typeTag = '<span class="inquiry-tag bench">æ¯”ä»·å‹</span>';
                if (s.inquiryType === 'risk_shifting') typeTag = '<span class="inquiry-tag risk">é£é™©è½¬ç§»å‹</span>';
                
                const html = `
                    <div class="inquiry-paper">
                        ${typeTag}
                        <div class="data-row"><span class="data-label">å®¢æˆ·ç±»å‹:</span><span class="data-value">${s.customer}</span></div>
                        <div class="data-row"><span class="data-label">åº”ç”¨åœºæ™¯:</span><span class="data-value">${s.application}</span></div>
                        <div class="data-row"><span class="data-label">äº§å“ç±»å‹:</span><span class="data-value">${s.product}</span></div>
                        <div class="data-row"><span class="data-label">æ•°é‡:</span><span class="data-value">${s.quantity}</span></div>
                        <div class="data-row"><span class="data-label">äº¤æœŸè¦æ±‚:</span><span class="data-value">${s.delivery}</span></div>
                        <div class="data-row"><span class="data-label">ä»˜æ¬¾æ¡ä»¶:</span><span class="data-value ${s.payment.includes('Not') || s.payment.includes('Unclear') || s.payment.includes('Pending') ? 'highlight-bad' : ''}">${s.payment}</span></div>
                        <div class="data-row"><span class="data-label">å®¢æˆ·ä»·æ ¼é¢„æœŸ:</span><span class="data-value">${s.targetPrice}</span></div>
                        <div class="data-row" style="border:none"><span class="data-label">è¡¥å……è¯´æ˜:</span><span class="data-value">${s.additionalInfo}</span></div>
                    </div>
                `;
                this.elements.inquiryContainer.innerHTML = html;

                if (this.mode === 'assessment') {
                    this.elements.mentorContainer.style.display = 'none';
                } else {
                    this.elements.mentorContainer.style.display = 'block';
                    this.elements.mentorHint.innerText = s.hint;
                    this.elements.mentorHint.style.color = "#9a3412";
                    this.elements.mentorContainer.style.borderColor = "#f97316";
                }
            },

            selectStrategy: function(strategy, btnElement) {
                this.selectedStrategy = strategy;
                this.elements.strategyBtns.forEach(b => b.classList.remove('selected'));
                btnElement.classList.add('selected');
                this.checkSubmitState();
                this.updateMentorHint();
            },

            updateMentorHint: function() {
                if (this.mode === 'assessment') return;
                // Dynamic hint logic remains similar but can be expanded
                const logic = this.currentScenario.logic;
                if (logic.riskLevel === 'critical' && this.selectedStrategy !== 'conservative') {
                    this.elements.mentorHint.innerText = "âš  å…³é”®é£é™©ï¼šæ­¤åœºæ™¯å»ºè®®é‡‡ç”¨ä¿å®ˆå‹ç­–ç•¥ã€‚";
                    this.elements.mentorHint.style.color = "#ef4444";
                    this.elements.mentorContainer.style.borderColor = "#ef4444";
                } else {
                    this.elements.mentorHint.innerText = this.currentScenario.hint;
                    this.elements.mentorHint.style.color = "#9a3412";
                    this.elements.mentorContainer.style.borderColor = "#f97316";
                }
            },

            checkSubmitState: function() {
                const text = this.elements.explanation.value.trim();
                this.elements.submitBtn.disabled = !(this.selectedStrategy && text.length > 10);
            },

            submitQuote: function() {
                const result = this.calculateScore();
                const checkedBoxes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
                
                // Save detailed data for report
                this.sessionResults.push({
                    scenarioId: this.currentScenario.id,
                    level: this.currentScenario.level,
                    customer: this.currentScenario.customer,
                    product: this.currentScenario.product,
                    inquiryType: this.currentScenario.inquiryType,
                    selectedStrategy: this.selectedStrategy,
                    selectedConditions: checkedBoxes,
                    explanationText: this.elements.explanation.value,
                    score: result.scores.total,
                    detail: result.scores,
                    isBlocked: result.isManagementBlock,
                    feedbackSummary: result.feedback
                });

                this.showFeedback(result);
            },

            calculateScore: function() {
                const lvl = this.currentScenario.level;
                const logic = this.currentScenario.logic;
                const inquiryType = this.currentScenario.inquiryType || 'standard';
                const modifier = inquiryTypeModifiers[inquiryType];
                const checkedBoxes = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
                const explanationText = this.elements.explanation.value.toLowerCase();
                
                let scores = { strategy: 0, risk: 0, conditions: 0, explanation: 0, total: 0 };
                let feedback = [];
                let isManagementBlock = false;

                // --- 1. Strategy Scoring ---
                if (lvl === 1) {
                    if (this.selectedStrategy === logic.optimalStrategy) scores.strategy = 30;
                    else if (this.selectedStrategy === 'balanced') scores.strategy = 25;
                    else scores.strategy = 10;
                    if (logic.riskLevel === 'high' && this.selectedStrategy === 'aggressive') {
                        scores.strategy = 10;
                        feedback.push({ type: 'error', title: 'æ–°æ‰‹é£é™©', msg: 'ä¸è¦åœ¨é«˜é£é™©é¡¹ç›®ä¸Šé‡‡ç”¨æ¿€è¿›çš„å®šä»·è¿›è¡ŒèµŒåšã€‚' });
                    }
                } else if (lvl === 2) {
                    if (this.selectedStrategy === logic.optimalStrategy) scores.strategy = 30;
                    else if (this.selectedStrategy === 'balanced') { scores.strategy = 20; feedback.push({ type: 'warning', title: 'é”™å¤±æœºä¼š', msg: 'å¹³è¡¡æ˜¯å®‰å…¨çš„ï¼Œä½†æ‚¨é”™è¿‡äº†æœ¬åœºæ™¯çš„æœ€ä½³æƒè¡¡ã€‚' }); }
                    else scores.strategy = 10;
                } else {
                    if (this.selectedStrategy === logic.optimalStrategy) scores.strategy = 30;
                    else if (this.selectedStrategy === 'balanced') {
                        if (logic.riskLevel === 'critical') { scores.strategy = 5; feedback.push({ type: 'error', title: 'ä½ä¼°é£é™©', msg: 'åœ¨å…³é”®é£é™©åœºæ™¯ä¸­ï¼Œå¹³è¡¡ç­–ç•¥ä¾ç„¶è¿‡äºå±é™©ã€‚' }); }
                        else scores.strategy = 15;
                    } else {
                        scores.strategy = 0;
                        isManagementBlock = true;
                        feedback.push({ type: 'error', title: 'ç®¡ç†å±‚å¦å†³', msg: 'åœ¨æ­¤åœºæ™¯ä¸‹ç¦æ­¢ä½¿ç”¨æ¿€è¿›å®šä»·ã€‚' });
                    }
                }

                // InquiryType Modifier: Strategy
                if (modifier) {
                    if (modifier.strategyScoreCap && scores.strategy > modifier.strategyScoreCap) {
                        scores.strategy = modifier.strategyScoreCap;
                        feedback.push({ type: 'warning', title: 'è¯¢ä»·ç±»å‹ä¿®æ­£', msg: 'è¯•æ¢å‹è¯¢ä»·ä¸åº”ç»™äºˆè¿‡é«˜ç­–ç•¥æƒé‡ã€‚' });
                    }
                    if (modifier.aggressivePenalty && this.selectedStrategy === 'aggressive') {
                        scores.strategy = Math.max(0, scores.strategy - 10);
                        feedback.push({ type: 'warning', title: 'æ¯”ä»·å‹è¯¢ä»·é£é™©', msg: 'åœ¨æ¯”ä»·å‹è¯¢ä»·ä¸­é‡‡ç”¨æ¿€è¿›ç­–ç•¥ï¼Œé€šå¸¸åªä¼šæˆä¸ºä»·æ ¼å‚è€ƒã€‚' });
                    }
                }

                // --- 2. Risk Scoring ---
                let riskScore = 25;
                const missingRequired = logic.requiredConditions.filter(req => !checkedBoxes.includes(req));
                if (missingRequired.length > 0) {
                    riskScore -= (missingRequired.length * 10);
                    feedback.push({ type: 'warning', title: 'æœªä¿æŠ¤çš„é£é™©', msg: `ç¼ºå¤±æ¡æ¬¾: ${missingRequired.join(", ")}ã€‚` });
                }
                if (lvl === 3) {
                    if (missingRequired.length > 0) riskScore = 0;
                    if (logic.riskLevel === 'critical' && this.selectedStrategy !== 'conservative') riskScore = 0;
                }

                // InquiryType Modifier: Risk
                if (modifier) {
                    if (modifier.riskPenaltyMultiplier && missingRequired.length > 0) {
                        riskScore = Math.max(0, Math.round(riskScore / modifier.riskPenaltyMultiplier));
                        feedback.push({ type: 'warning', title: 'è¯¢ä»·æ¥æºé£é™©', msg: 'ç”±äºè¯¢ä»·æ¥æºä¸é€æ˜ï¼Œé£é™©æ§åˆ¶è¦æ±‚æ›´ä¸¥æ ¼ã€‚' });
                    }
                    if (modifier.paymentRequired && !checkedBoxes.includes('payment_spec')) {
                        riskScore = 0;
                        isManagementBlock = true;
                        feedback.push({ type: 'block', title: 'ä»˜æ¬¾é£é™©ä¸å¯æ¥å—', msg: 'é£é™©è½¬ç§»å‹è¯¢ä»·å¿…é¡»æ˜ç¡®ä»˜æ¬¾æ¡ä»¶ï¼Œå¦åˆ™ä¸å…è®¸æŠ¥ä»·ã€‚' });
                    }
                }
                scores.risk = Math.max(0, riskScore);

                // --- 3. Conditions Scoring ---
                let condScore = 10;
                if (checkedBoxes.length === 0) condScore = 0;
                const hitBonus = logic.bonusConditions.filter(b => checkedBoxes.includes(b));
                condScore += (hitBonus.length * 3);
                if (modifier && modifier.validityRequired && !checkedBoxes.includes('validity')) {
                    condScore = 0;
                    feedback.push({ type: 'warning', title: 'ç¼ºå°‘æœ‰æ•ˆæœŸæ¡æ¬¾', msg: 'è¯•å•æŠ¥ä»·å¿…é¡»é”å®šæœ‰æ•ˆæœŸï¼Œé˜²æ­¢ä»·æ ¼è¢«åŠ¨é”æ­»ã€‚' });
                }
                scores.conditions = Math.max(0, Math.min(15, condScore));

                // --- 4. Explanation Scoring ---
                const logicPatterns = ["å› ä¸º", "ç”±äº", "å› æ­¤", "è€ƒè™‘åˆ°", "å¯¼è‡´", "åŸºäº", "ä¸ºäº†", "æ‰€ä»¥"];
                const hasLogic = logicPatterns.some(p => explanationText.includes(p));
                const keywords = ["æˆæœ¬", "é£é™©", "åˆ©æ¶¦", "ç«äº‰", "è´¨é‡", "å¸‚åœº", "äº¤æœŸ", "ä»˜æ¬¾"];
                let keywordCount = 0;
                keywords.forEach(k => { if (explanationText.includes(k)) keywordCount++; });

                if (explanationText.length < 20) {
                    scores.explanation = 5;
                    feedback.push({ type: 'warning', title: 'è¯´æ˜ä¸è¶³', msg: 'ç®¡ç†è€…éœ€è¦æ›´å¤šæ¨ç†ä¾æ®ã€‚' });
                } else {
                    scores.explanation = 10;
                    if (hasLogic) scores.explanation += 10;
                    else if (lvl >= 2 && keywordCount > 2) { scores.explanation -= 5; feedback.push({ type: 'warning', title: 'é€»è¾‘ç¼ºå¤±', msg: 'æ‚¨åˆ—ä¸¾äº†å› ç´ ï¼Œä½†æœªè§£é‡Šå› æœè”ç³»ã€‚' }); }
                    scores.explanation += Math.min(10, keywordCount * 2);
                }

                // InquiryType Modifier: Explanation
                if (modifier && modifier.explanationBonusRequired) {
                    const responsibilityKeywords = ["ä»˜æ¬¾", "è´£ä»»", "ç»ˆç«¯", "é£é™©æ‰¿æ‹…"];
                    const hasResponsibilityLogic = responsibilityKeywords.some(k => explanationText.includes(k));
                    if (!hasResponsibilityLogic) {
                        scores.explanation = Math.max(0, scores.explanation - 8);
                        feedback.push({ type: 'warning', title: 'è¯´æ˜ä¸è¶³', msg: 'è½¬å‘å‹è¯¢ä»·éœ€è¦æ˜ç¡®è¯´æ˜è´£ä»»ä¸ä»˜æ¬¾å½’å±ã€‚' });
                    }
                }
                if (modifier && modifier.disableBonus) {
                    if (scores.explanation > 20 && explanationText.includes("æœªæ¥")) {
                        scores.explanation = 20;
                        feedback.push({ type: 'warning', title: 'æœªæ¥æ‰¿è¯ºä¸å¯è®¡åˆ†', msg: 'æœªæ¥è®¢å•æ‰¿è¯ºä¸åº”æŠµæ¶ˆå½“å‰å•†ä¸šé£é™©ã€‚' });
                    }
                }

                // Total
                if (isManagementBlock) {
                    scores.total = Math.min(scores.total, 50);
                    feedback.unshift({ type: 'block', title: 'ç®¡ç†å±‚å¦å†³', msg: 'è¯¥æŠ¥ä»·å†³ç­–è¿åå…¬å¸é£é™©æ§åˆ¶è¦æ±‚ï¼Œä¸å…è®¸è¿›è¡Œç‹¬ç«‹æŠ¥ä»·ã€‚' });
                } else {
                    scores.total = Math.min(100, scores.strategy + scores.risk + scores.conditions + scores.explanation);
                }

                let outcome = "";
                if (isManagementBlock) outcome = "å·²è§¦å‘ç®¡ç†å±‚å¦å†³ã€‚é‚®ä»¶æœªå‘é€ã€‚";
                else if (scores.total < 60) outcome = "æŠ¥ä»·å·²å‘é€ï¼Œä½†å†…éƒ¨å®¡æ‰¹å› åˆ©æ¶¦/é£é™©é—®é¢˜æœªé€šè¿‡ã€‚";
                else if (scores.total < 80) outcome = "æŠ¥ä»·å·²å‘é€ï¼Œä½†å®¢æˆ·è¦æ±‚è¿›ä¸€æ­¥æ¾„æ¸…æˆ–è°ƒæ•´ã€‚";
                else outcome = "æŠ¥ä»·é€šè¿‡å†…éƒ¨å®¡æ‰¹ï¼Œå…·å¤‡è°ˆåˆ¤ä¼˜åŠ¿ã€‚";

                return { scores, feedback, outcome, isManagementBlock };
            },

            showFeedback: function(result) {
                const { scores, feedback, outcome, isManagementBlock } = result;
                document.getElementById('modal-score').innerText = scores.total;
                
                if (this.mode === 'assessment') {
                    this.elements.detailScores.style.display = 'none';
                    this.elements.assessmentDisclaimer.style.display = 'block';
                } else {
                    this.elements.detailScores.style.display = 'grid';
                    this.elements.assessmentDisclaimer.style.display = 'none';
                    this.elements.scoreDetails.strategy.innerText = `${scores.strategy}/30`;
                    this.elements.scoreDetails.risk.innerText = `${scores.risk}/25`;
                    this.elements.scoreDetails.conditions.innerText = `${scores.conditions}/15`;
                    this.elements.scoreDetails.explanation.innerText = `${scores.explanation}/30`;
                }

                let fbHtml = '';
                if (this.mode === 'assessment') {
                    let authStatus = "", authClass = "";
                    if (isManagementBlock) { authStatus = "âŒ ä¸å…·å¤‡æŠ¥ä»·èµ„æ ¼"; authClass = "color: #ef4444; border-color: #ef4444;"; }
                    else if (scores.total >= 80) { authStatus = "âœ… æˆæƒé€šè¿‡"; authClass = "color: #10b981; border-color: #10b981;"; }
                    else { authStatus = "âš ï¸ éœ€å¤æ ¸"; authClass = "color: #f59e0b; border-color: #f59e0b;"; }

                    fbHtml += `<div class="feedback-section authority" style="border:${authClass}"><h4 style="margin-bottom:5px; font-size:1.1rem; ${authClass.split(';')[0]}">${authStatus}</h4><div style="font-size:0.85rem; opacity:0.8;">${isManagementBlock ? "ä¸å…è®¸ç‹¬ç«‹æŠ¥ä»·ã€‚" : (scores.total >= 80 ? "å…·å¤‡ç‹¬ç«‹æŠ¥ä»·èµ„æ ¼ã€‚" : "éœ€ä¸»ç®¡å¤æ ¸åæ–¹å¯æŠ¥ä»·ã€‚")}</div></div>`;
                }

                fbHtml += `<div class="feedback-section outcome"><span class="feedback-title" style="color:var(--primary-color)">ğŸ“‰ å¯èƒ½ç»“æœè¯„ä¼°</span>${outcome}</div>`;
                if (this.mode === 'training') {
                    feedback.forEach(f => { fbHtml += `<div class="feedback-section ${f.type}"><span class="feedback-title">${f.title}</span>${f.msg}</div>`; });
                }
                this.elements.feedbackContainer.innerHTML = fbHtml;
                this.elements.modal.classList.add('active');

                if (this.currentRound < this.sessionScenarios.length - 1) {
                    this.elements.nextBtn.style.display = 'block';
                    this.elements.finishBtn.style.display = 'none';
                } else {
                    this.elements.nextBtn.style.display = 'none';
                    this.elements.finishBtn.style.display = 'block';
                }
            },

            nextRound: function() {
                this.elements.modal.classList.remove('active');
                setTimeout(() => { this.loadRound(this.currentRound + 1); }, 300);
            },

            finish: function() {
                this.elements.modal.classList.remove('active');
                this.showSessionSummary();
            },

            showSessionSummary: function() {
                const results = this.sessionResults;
                const avg = Math.round(results.reduce((a,b)=>a+b.score,0) / results.length);
                const avgRisk = Math.round(results.reduce((a,b)=>a+b.detail.risk,0) / results.length);
                const avgExp = Math.round(results.reduce((a,b)=>a+b.detail.explanation,0) / results.length);
                const blockCount = results.filter(r=>r.isBlocked).length;

                // LocalStorage Stats Update
                const stats = JSON.parse(localStorage.getItem("quoteLabStats") || "{}");
                stats.totalSessions = (stats.totalSessions || 0) + 1;
                stats.lastAvg = avg;
                localStorage.setItem("quoteLabStats", JSON.stringify(stats));

                const statsHtml = `
                    <div class="summary-module">
                        <div class="module-title">ğŸ“Š è¯„ä¼°æ¦‚è§ˆ</div>
                        <div class="stat-row"><span>æ¨¡å¼:</span> <span class="stat-value" style="text-transform:uppercase">${this.mode}</span></div>
                        <div class="stat-row"><span>æ€»é¢˜æ•°:</span> <span class="stat-value">${results.length}</span></div>
                        <div class="stat-row"><span>å¹³å‡åˆ†:</span> <span class="stat-value ${avg >= 80 ? 'green' : (avg < 60 ? 'red' : '')}">${avg} / 100</span></div>
                    </div>
                `;

                let recommendHtml = "";
                if (this.mode === 'training') {
                    let recs = [];
                    if (avgRisk < 18) recs.push("å»ºè®®é‡ç‚¹å­¦ä¹ ï¼šã€Šä»˜æ¬¾æ¡æ¬¾å¸¸è§é£é™©æ¸…å•ã€‹ã€ã€ŠæŠ€æœ¯æœªå†»ç»“æŠ¥ä»·çš„å…¸å‹å‘ã€‹");
                    if (avgExp < 20) recs.push("å»ºè®®è®­ç»ƒï¼šä½¿ç”¨ã€Œ3 å¥è¯è§£é‡ŠæŠ¥ä»·ã€æ¨¡æ¿å¼ºåŒ–é€»è¾‘è¡¨è¾¾");
                    if (blockCount > 0) recs.push("è­¦å‘Šï¼šä¸å»ºè®®ç«‹å³å‚ä¸é«˜é£é™©é¡¹ç›®æŠ¥ä»·ï¼Œéœ€å…ˆå»ºç«‹åŸºç¡€é£é™©æ„è¯†");
                    
                    if (recs.length > 0) {
                        recommendHtml = `
                            <div class="summary-module" style="border-left: 4px solid var(--accent-color);">
                                <div class="module-title">ğŸ¯ æ”¹è¿›æ–¹å‘å»ºè®®</div>
                                <ul style="padding-left: 1.5rem; font-size: 0.9rem; line-height: 1.5;">
                                    ${recs.map(r => `<li>${r}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                }

                let authHtml = "";
                if (this.mode === 'assessment') {
                    let status = "", color = "";
                    if (blockCount > 0 || avg < 60) { status = "âŒ ä¸å…·å¤‡æŠ¥ä»·èµ„æ ¼"; color = "#ef4444"; }
                    else if (avg >= 80) { status = "âœ… æˆæƒé€šè¿‡"; color = "#10b981"; }
                    else { status = "âš ï¸ éœ€å¤æ ¸"; color = "#f59e0b"; }
                    authHtml = `<div class="authority-block" style="background-color: ${color};"><div class="authority-status">${status}</div></div>`;
                } else {
                    authHtml = `<div class="authority-block"><div class="authority-status">ç»ƒä¹ å®Œæˆ</div><div class="authority-sub">æœ¬æ¬¡è®­ç»ƒå·²ç»“æŸï¼Œè¯·æ ¹æ®å»ºè®®è¿›è¡Œé’ˆå¯¹æ€§æå‡ã€‚</div></div>`;
                }

                document.getElementById('summary-content').innerHTML = `
                    <div class="summary-grid">${statsHtml}${recommendHtml}</div>
                    ${authHtml}
                `;

                this.elements.gameHeader.style.display = 'none';
                this.elements.gameMain.style.display = 'none';
                this.elements.gameFooter.style.display = 'none';
                this.elements.summaryScreen.style.display = 'block';
                window.scrollTo(0,0);
            },

            showDetailReport: function() {
                const results = this.sessionResults;
                document.getElementById('report-date').innerText = new Date().toLocaleDateString();
                document.getElementById('report-mode').innerText = this.mode.toUpperCase();
                
                let html = '';
                results.forEach(r => {
                    const stratMap = { 'aggressive': 'æ¿€è¿›å‹', 'balanced': 'å¹³è¡¡å‹', 'conservative': 'ä¿å®ˆå‹' };
                    const condMap = {
                        'validity': 'æŠ¥ä»·æœ‰æ•ˆæœŸè¯´æ˜',
                        'payment_spec': 'æ˜ç¡®ä»˜æ¬¾æ¡ä»¶',
                        'tech_clarify': 'ç¡®è®¤æŠ€æœ¯å‚æ•°',
                        'delivery_cond': 'äº¤æœŸå‰æè¯´æ˜'
                    };
                    
                    html += `
                        <div class="report-item">
                            <div class="report-meta">
                                <span><strong>åœºæ™¯ID:</strong> ${r.scenarioId}</span>
                                <span><strong>å¾—åˆ†:</strong> ${r.score}</span>
                            </div>
                            <div class="report-grid">
                                <div><span class="report-label">å®¢æˆ·:</span> <span class="report-val">${r.customer}</span></div>
                                <div><span class="report-label">äº§å“:</span> <span class="report-val">${r.product}</span></div>
                                <div><span class="report-label">ç­–ç•¥é€‰æ‹©:</span> <span class="report-val">${stratMap[r.selectedStrategy]}</span></div>
                                <div><span class="report-label">é£æ§æ¡æ¬¾:</span> <span class="report-val">${r.selectedConditions.length > 0 ? r.selectedConditions.map(c=>condMap[c]).join(', ') : 'æœªé€‰æ‹©'}</span></div>
                            </div>
                            <div class="report-label" style="margin-bottom:0.5rem">å†³ç­–è¯´æ˜åŸæ–‡:</div>
                            <div class="report-explanation">"${r.explanationText}"</div>
                        </div>
                    `;
                });
                
                document.getElementById('report-content').innerHTML = html;
                this.elements.summaryScreen.style.display = 'none';
                this.elements.detailReportView.style.display = 'block';
            },

            backToSummary: function() {
                this.elements.detailReportView.style.display = 'none';
                this.elements.summaryScreen.style.display = 'block';
            }
        };

        document.getElementById('user-explanation').addEventListener('input', () => { game.checkSubmitState(); });
    </script>
</body>
</html>
